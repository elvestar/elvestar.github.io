<!DOCTYPE html>
 <html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><style>/*!
 * Bootstrap v3.3.7 (http://getbootstrap.com)
 * Copyright 2011-2017 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 */

/*!
 * Generated using the Bootstrap Customizer (http://v3.bootcss.com/customize/?id=8390ea044f983f73e1d2f86f37b94f0d)
 * Config saved to config.json and https://gist.github.com/8390ea044f983f73e1d2f86f37b94f0d
 */

/*!
 * Bootstrap v3.3.7 (http://getbootstrap.com)
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 */

/*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}*,:after,:before{box-sizing:border-box}html{font-size:10px;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:14px;line-height:1.42857143;color:#333;background-color:#fff}button,input,select,textarea{font-family:inherit;font-size:inherit;line-height:inherit}a{color:#337ab7;text-decoration:none}a:focus,a:hover{color:#23527c;text-decoration:underline}a:focus{outline:5px auto -webkit-focus-ring-color;outline-offset:-2px}figure{margin:0}img{vertical-align:middle}.img-responsive{display:block;max-width:100%;height:auto}.img-rounded{border-radius:6px}.img-thumbnail{padding:4px;line-height:1.42857143;background-color:#fff;border:1px solid #ddd;border-radius:4px;transition:all .2s ease-in-out;display:inline-block;max-width:100%;height:auto}.img-circle{border-radius:50%}hr{margin-top:20px;margin-bottom:20px;border:0;border-top:1px solid #eee}.sr-only{position:absolute;width:1px;height:1px;margin:-1px;padding:0;overflow:hidden;clip:rect(0,0,0,0);border:0}.sr-only-focusable:active,.sr-only-focusable:focus{position:static;width:auto;height:auto;margin:0;overflow:visible;clip:auto}[role=button]{cursor:pointer}.container{margin-right:auto;margin-left:auto;padding-left:15px;padding-right:15px}@media (min-width:768px){.container{width:750px}}@media (min-width:992px){.container{width:970px}}@media (min-width:1200px){.container{width:1170px}}.container-fluid{margin-right:auto;margin-left:auto;padding-left:15px;padding-right:15px}.row{margin-left:-15px;margin-right:-15px}.col-lg-1,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-lg-10,.col-lg-11,.col-lg-12,.col-md-1,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-md-10,.col-md-11,.col-md-12,.col-sm-1,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9,.col-sm-10,.col-sm-11,.col-sm-12,.col-xs-1,.col-xs-2,.col-xs-3,.col-xs-4,.col-xs-5,.col-xs-6,.col-xs-7,.col-xs-8,.col-xs-9,.col-xs-10,.col-xs-11,.col-xs-12{position:relative;min-height:1px;padding-left:15px;padding-right:15px}.col-xs-1,.col-xs-2,.col-xs-3,.col-xs-4,.col-xs-5,.col-xs-6,.col-xs-7,.col-xs-8,.col-xs-9,.col-xs-10,.col-xs-11,.col-xs-12{float:left}.col-xs-12{width:100%}.col-xs-11{width:91.66666667%}.col-xs-10{width:83.33333333%}.col-xs-9{width:75%}.col-xs-8{width:66.66666667%}.col-xs-7{width:58.33333333%}.col-xs-6{width:50%}.col-xs-5{width:41.66666667%}.col-xs-4{width:33.33333333%}.col-xs-3{width:25%}.col-xs-2{width:16.66666667%}.col-xs-1{width:8.33333333%}.col-xs-pull-12{right:100%}.col-xs-pull-11{right:91.66666667%}.col-xs-pull-10{right:83.33333333%}.col-xs-pull-9{right:75%}.col-xs-pull-8{right:66.66666667%}.col-xs-pull-7{right:58.33333333%}.col-xs-pull-6{right:50%}.col-xs-pull-5{right:41.66666667%}.col-xs-pull-4{right:33.33333333%}.col-xs-pull-3{right:25%}.col-xs-pull-2{right:16.66666667%}.col-xs-pull-1{right:8.33333333%}.col-xs-pull-0{right:auto}.col-xs-push-12{left:100%}.col-xs-push-11{left:91.66666667%}.col-xs-push-10{left:83.33333333%}.col-xs-push-9{left:75%}.col-xs-push-8{left:66.66666667%}.col-xs-push-7{left:58.33333333%}.col-xs-push-6{left:50%}.col-xs-push-5{left:41.66666667%}.col-xs-push-4{left:33.33333333%}.col-xs-push-3{left:25%}.col-xs-push-2{left:16.66666667%}.col-xs-push-1{left:8.33333333%}.col-xs-push-0{left:auto}.col-xs-offset-12{margin-left:100%}.col-xs-offset-11{margin-left:91.66666667%}.col-xs-offset-10{margin-left:83.33333333%}.col-xs-offset-9{margin-left:75%}.col-xs-offset-8{margin-left:66.66666667%}.col-xs-offset-7{margin-left:58.33333333%}.col-xs-offset-6{margin-left:50%}.col-xs-offset-5{margin-left:41.66666667%}.col-xs-offset-4{margin-left:33.33333333%}.col-xs-offset-3{margin-left:25%}.col-xs-offset-2{margin-left:16.66666667%}.col-xs-offset-1{margin-left:8.33333333%}.col-xs-offset-0{margin-left:0}@media (min-width:768px){.col-sm-1,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9,.col-sm-10,.col-sm-11,.col-sm-12{float:left}.col-sm-12{width:100%}.col-sm-11{width:91.66666667%}.col-sm-10{width:83.33333333%}.col-sm-9{width:75%}.col-sm-8{width:66.66666667%}.col-sm-7{width:58.33333333%}.col-sm-6{width:50%}.col-sm-5{width:41.66666667%}.col-sm-4{width:33.33333333%}.col-sm-3{width:25%}.col-sm-2{width:16.66666667%}.col-sm-1{width:8.33333333%}.col-sm-pull-12{right:100%}.col-sm-pull-11{right:91.66666667%}.col-sm-pull-10{right:83.33333333%}.col-sm-pull-9{right:75%}.col-sm-pull-8{right:66.66666667%}.col-sm-pull-7{right:58.33333333%}.col-sm-pull-6{right:50%}.col-sm-pull-5{right:41.66666667%}.col-sm-pull-4{right:33.33333333%}.col-sm-pull-3{right:25%}.col-sm-pull-2{right:16.66666667%}.col-sm-pull-1{right:8.33333333%}.col-sm-pull-0{right:auto}.col-sm-push-12{left:100%}.col-sm-push-11{left:91.66666667%}.col-sm-push-10{left:83.33333333%}.col-sm-push-9{left:75%}.col-sm-push-8{left:66.66666667%}.col-sm-push-7{left:58.33333333%}.col-sm-push-6{left:50%}.col-sm-push-5{left:41.66666667%}.col-sm-push-4{left:33.33333333%}.col-sm-push-3{left:25%}.col-sm-push-2{left:16.66666667%}.col-sm-push-1{left:8.33333333%}.col-sm-push-0{left:auto}.col-sm-offset-12{margin-left:100%}.col-sm-offset-11{margin-left:91.66666667%}.col-sm-offset-10{margin-left:83.33333333%}.col-sm-offset-9{margin-left:75%}.col-sm-offset-8{margin-left:66.66666667%}.col-sm-offset-7{margin-left:58.33333333%}.col-sm-offset-6{margin-left:50%}.col-sm-offset-5{margin-left:41.66666667%}.col-sm-offset-4{margin-left:33.33333333%}.col-sm-offset-3{margin-left:25%}.col-sm-offset-2{margin-left:16.66666667%}.col-sm-offset-1{margin-left:8.33333333%}.col-sm-offset-0{margin-left:0}}@media (min-width:992px){.col-md-1,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-md-10,.col-md-11,.col-md-12{float:left}.col-md-12{width:100%}.col-md-11{width:91.66666667%}.col-md-10{width:83.33333333%}.col-md-9{width:75%}.col-md-8{width:66.66666667%}.col-md-7{width:58.33333333%}.col-md-6{width:50%}.col-md-5{width:41.66666667%}.col-md-4{width:33.33333333%}.col-md-3{width:25%}.col-md-2{width:16.66666667%}.col-md-1{width:8.33333333%}.col-md-pull-12{right:100%}.col-md-pull-11{right:91.66666667%}.col-md-pull-10{right:83.33333333%}.col-md-pull-9{right:75%}.col-md-pull-8{right:66.66666667%}.col-md-pull-7{right:58.33333333%}.col-md-pull-6{right:50%}.col-md-pull-5{right:41.66666667%}.col-md-pull-4{right:33.33333333%}.col-md-pull-3{right:25%}.col-md-pull-2{right:16.66666667%}.col-md-pull-1{right:8.33333333%}.col-md-pull-0{right:auto}.col-md-push-12{left:100%}.col-md-push-11{left:91.66666667%}.col-md-push-10{left:83.33333333%}.col-md-push-9{left:75%}.col-md-push-8{left:66.66666667%}.col-md-push-7{left:58.33333333%}.col-md-push-6{left:50%}.col-md-push-5{left:41.66666667%}.col-md-push-4{left:33.33333333%}.col-md-push-3{left:25%}.col-md-push-2{left:16.66666667%}.col-md-push-1{left:8.33333333%}.col-md-push-0{left:auto}.col-md-offset-12{margin-left:100%}.col-md-offset-11{margin-left:91.66666667%}.col-md-offset-10{margin-left:83.33333333%}.col-md-offset-9{margin-left:75%}.col-md-offset-8{margin-left:66.66666667%}.col-md-offset-7{margin-left:58.33333333%}.col-md-offset-6{margin-left:50%}.col-md-offset-5{margin-left:41.66666667%}.col-md-offset-4{margin-left:33.33333333%}.col-md-offset-3{margin-left:25%}.col-md-offset-2{margin-left:16.66666667%}.col-md-offset-1{margin-left:8.33333333%}.col-md-offset-0{margin-left:0}}@media (min-width:1200px){.col-lg-1,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-lg-10,.col-lg-11,.col-lg-12{float:left}.col-lg-12{width:100%}.col-lg-11{width:91.66666667%}.col-lg-10{width:83.33333333%}.col-lg-9{width:75%}.col-lg-8{width:66.66666667%}.col-lg-7{width:58.33333333%}.col-lg-6{width:50%}.col-lg-5{width:41.66666667%}.col-lg-4{width:33.33333333%}.col-lg-3{width:25%}.col-lg-2{width:16.66666667%}.col-lg-1{width:8.33333333%}.col-lg-pull-12{right:100%}.col-lg-pull-11{right:91.66666667%}.col-lg-pull-10{right:83.33333333%}.col-lg-pull-9{right:75%}.col-lg-pull-8{right:66.66666667%}.col-lg-pull-7{right:58.33333333%}.col-lg-pull-6{right:50%}.col-lg-pull-5{right:41.66666667%}.col-lg-pull-4{right:33.33333333%}.col-lg-pull-3{right:25%}.col-lg-pull-2{right:16.66666667%}.col-lg-pull-1{right:8.33333333%}.col-lg-pull-0{right:auto}.col-lg-push-12{left:100%}.col-lg-push-11{left:91.66666667%}.col-lg-push-10{left:83.33333333%}.col-lg-push-9{left:75%}.col-lg-push-8{left:66.66666667%}.col-lg-push-7{left:58.33333333%}.col-lg-push-6{left:50%}.col-lg-push-5{left:41.66666667%}.col-lg-push-4{left:33.33333333%}.col-lg-push-3{left:25%}.col-lg-push-2{left:16.66666667%}.col-lg-push-1{left:8.33333333%}.col-lg-push-0{left:auto}.col-lg-offset-12{margin-left:100%}.col-lg-offset-11{margin-left:91.66666667%}.col-lg-offset-10{margin-left:83.33333333%}.col-lg-offset-9{margin-left:75%}.col-lg-offset-8{margin-left:66.66666667%}.col-lg-offset-7{margin-left:58.33333333%}.col-lg-offset-6{margin-left:50%}.col-lg-offset-5{margin-left:41.66666667%}.col-lg-offset-4{margin-left:33.33333333%}.col-lg-offset-3{margin-left:25%}.col-lg-offset-2{margin-left:16.66666667%}.col-lg-offset-1{margin-left:8.33333333%}.col-lg-offset-0{margin-left:0}}fieldset{margin:0;min-width:0}fieldset,legend{padding:0;border:0}legend{display:block;width:100%;margin-bottom:20px;font-size:21px;line-height:inherit;color:#333;border-bottom:1px solid #e5e5e5}label{display:inline-block;max-width:100%;margin-bottom:5px;font-weight:700}input[type=search]{box-sizing:border-box}input[type=checkbox],input[type=radio]{margin:4px 0 0;margin-top:1px\9;line-height:normal}input[type=file]{display:block}input[type=range]{display:block;width:100%}select[multiple],select[size]{height:auto}input[type=checkbox]:focus,input[type=file]:focus,input[type=radio]:focus{outline:5px auto -webkit-focus-ring-color;outline-offset:-2px}output{padding-top:7px}.form-control,output{display:block;font-size:14px;line-height:1.42857143;color:#555}.form-control{width:100%;height:34px;padding:6px 12px;background-color:#fff;background-image:none;border:1px solid #ccc;border-radius:4px;box-shadow:inset 0 1px 1px rgba(0,0,0,.075);transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out}.form-control:focus{border-color:#66afe9;outline:0;box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6)}.form-control::-moz-placeholder{color:#999;opacity:1}.form-control:-ms-input-placeholder{color:#999}.form-control::-webkit-input-placeholder{color:#999}.form-control::-ms-expand{border:0;background-color:transparent}.form-control[disabled],.form-control[readonly],fieldset[disabled] .form-control{background-color:#eee;opacity:1}.form-control[disabled],fieldset[disabled] .form-control{cursor:not-allowed}textarea.form-control{height:auto}input[type=search]{-webkit-appearance:none}@media screen and (-webkit-min-device-pixel-ratio:0){input[type=date].form-control,input[type=datetime-local].form-control,input[type=month].form-control,input[type=time].form-control{line-height:34px}.input-group-sm input[type=date],.input-group-sm input[type=datetime-local],.input-group-sm input[type=month],.input-group-sm input[type=time],input[type=date].input-sm,input[type=datetime-local].input-sm,input[type=month].input-sm,input[type=time].input-sm{line-height:30px}.input-group-lg input[type=date],.input-group-lg input[type=datetime-local],.input-group-lg input[type=month],.input-group-lg input[type=time],input[type=date].input-lg,input[type=datetime-local].input-lg,input[type=month].input-lg,input[type=time].input-lg{line-height:46px}}.form-group{margin-bottom:15px}.checkbox,.radio{position:relative;display:block;margin-top:10px;margin-bottom:10px}.checkbox label,.radio label{min-height:20px;padding-left:20px;margin-bottom:0;font-weight:400;cursor:pointer}.checkbox-inline input[type=checkbox],.checkbox input[type=checkbox],.radio-inline input[type=radio],.radio input[type=radio]{position:absolute;margin-left:-20px;margin-top:4px\9}.checkbox+.checkbox,.radio+.radio{margin-top:-5px}.checkbox-inline,.radio-inline{position:relative;display:inline-block;padding-left:20px;margin-bottom:0;vertical-align:middle;font-weight:400;cursor:pointer}.checkbox-inline+.checkbox-inline,.radio-inline+.radio-inline{margin-top:0;margin-left:10px}.checkbox-inline.disabled,.checkbox.disabled label,.radio-inline.disabled,.radio.disabled label,fieldset[disabled] .checkbox-inline,fieldset[disabled] .checkbox label,fieldset[disabled] .radio-inline,fieldset[disabled] .radio label,fieldset[disabled] input[type=checkbox],fieldset[disabled] input[type=radio],input[type=checkbox].disabled,input[type=checkbox][disabled],input[type=radio].disabled,input[type=radio][disabled]{cursor:not-allowed}.form-control-static{padding-top:7px;padding-bottom:7px;margin-bottom:0;min-height:34px}.form-control-static.input-lg,.form-control-static.input-sm{padding-left:0;padding-right:0}.input-sm{height:30px;padding:5px 10px;font-size:12px;line-height:1.5;border-radius:3px}select.input-sm{height:30px;line-height:30px}select[multiple].input-sm,textarea.input-sm{height:auto}.form-group-sm .form-control{height:30px;padding:5px 10px;font-size:12px;line-height:1.5;border-radius:3px}.form-group-sm select.form-control{height:30px;line-height:30px}.form-group-sm select[multiple].form-control,.form-group-sm textarea.form-control{height:auto}.form-group-sm .form-control-static{height:30px;min-height:32px;padding:6px 10px;font-size:12px;line-height:1.5}.input-lg{height:46px;padding:10px 16px;font-size:18px;line-height:1.3333333;border-radius:6px}select.input-lg{height:46px;line-height:46px}select[multiple].input-lg,textarea.input-lg{height:auto}.form-group-lg .form-control{height:46px;padding:10px 16px;font-size:18px;line-height:1.3333333;border-radius:6px}.form-group-lg select.form-control{height:46px;line-height:46px}.form-group-lg select[multiple].form-control,.form-group-lg textarea.form-control{height:auto}.form-group-lg .form-control-static{height:46px;min-height:38px;padding:11px 16px;font-size:18px;line-height:1.3333333}.has-feedback{position:relative}.has-feedback .form-control{padding-right:42.5px}.form-control-feedback{position:absolute;top:0;right:0;z-index:2;display:block;width:34px;height:34px;line-height:34px;text-align:center;pointer-events:none}.form-group-lg .form-control+.form-control-feedback,.input-group-lg+.form-control-feedback,.input-lg+.form-control-feedback{width:46px;height:46px;line-height:46px}.form-group-sm .form-control+.form-control-feedback,.input-group-sm+.form-control-feedback,.input-sm+.form-control-feedback{width:30px;height:30px;line-height:30px}.has-success .checkbox,.has-success .checkbox-inline,.has-success.checkbox-inline label,.has-success.checkbox label,.has-success .control-label,.has-success .help-block,.has-success .radio,.has-success .radio-inline,.has-success.radio-inline label,.has-success.radio label{color:#3c763d}.has-success .form-control{border-color:#3c763d;box-shadow:inset 0 1px 1px rgba(0,0,0,.075)}.has-success .form-control:focus{border-color:#2b542c;box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #67b168}.has-success .input-group-addon{color:#3c763d;border-color:#3c763d;background-color:#dff0d8}.has-success .form-control-feedback{color:#3c763d}.has-warning .checkbox,.has-warning .checkbox-inline,.has-warning.checkbox-inline label,.has-warning.checkbox label,.has-warning .control-label,.has-warning .help-block,.has-warning .radio,.has-warning .radio-inline,.has-warning.radio-inline label,.has-warning.radio label{color:#8a6d3b}.has-warning .form-control{border-color:#8a6d3b;box-shadow:inset 0 1px 1px rgba(0,0,0,.075)}.has-warning .form-control:focus{border-color:#66512c;box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #c0a16b}.has-warning .input-group-addon{color:#8a6d3b;border-color:#8a6d3b;background-color:#fcf8e3}.has-warning .form-control-feedback{color:#8a6d3b}.has-error .checkbox,.has-error .checkbox-inline,.has-error.checkbox-inline label,.has-error.checkbox label,.has-error .control-label,.has-error .help-block,.has-error .radio,.has-error .radio-inline,.has-error.radio-inline label,.has-error.radio label{color:#a94442}.has-error .form-control{border-color:#a94442;box-shadow:inset 0 1px 1px rgba(0,0,0,.075)}.has-error .form-control:focus{border-color:#843534;box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #ce8483}.has-error .input-group-addon{color:#a94442;border-color:#a94442;background-color:#f2dede}.has-error .form-control-feedback{color:#a94442}.has-feedback label~.form-control-feedback{top:25px}.has-feedback label.sr-only~.form-control-feedback{top:0}.help-block{display:block;margin-top:5px;margin-bottom:10px;color:#737373}@media (min-width:768px){.form-inline .form-group{display:inline-block;margin-bottom:0;vertical-align:middle}.form-inline .form-control{display:inline-block;width:auto;vertical-align:middle}.form-inline .form-control-static{display:inline-block}.form-inline .input-group{display:inline-table;vertical-align:middle}.form-inline .input-group .form-control,.form-inline .input-group .input-group-addon,.form-inline .input-group .input-group-btn{width:auto}.form-inline .input-group>.form-control{width:100%}.form-inline .control-label{margin-bottom:0;vertical-align:middle}.form-inline .checkbox,.form-inline .radio{display:inline-block;margin-top:0;margin-bottom:0;vertical-align:middle}.form-inline .checkbox label,.form-inline .radio label{padding-left:0}.form-inline .checkbox input[type=checkbox],.form-inline .radio input[type=radio]{position:relative;margin-left:0}.form-inline .has-feedback .form-control-feedback{top:0}}.form-horizontal .checkbox,.form-horizontal .checkbox-inline,.form-horizontal .radio,.form-horizontal .radio-inline{margin-top:0;margin-bottom:0;padding-top:7px}.form-horizontal .checkbox,.form-horizontal .radio{min-height:27px}.form-horizontal .form-group{margin-left:-15px;margin-right:-15px}@media (min-width:768px){.form-horizontal .control-label{text-align:right;margin-bottom:0;padding-top:7px}}.form-horizontal .has-feedback .form-control-feedback{right:15px}@media (min-width:768px){.form-horizontal .form-group-lg .control-label{padding-top:11px;font-size:18px}}@media (min-width:768px){.form-horizontal .form-group-sm .control-label{padding-top:6px;font-size:12px}}.nav{margin-bottom:0;padding-left:0;list-style:none}.nav>li,.nav>li>a{position:relative;display:block}.nav>li>a{padding:10px 15px}.nav>li>a:focus,.nav>li>a:hover{text-decoration:none;background-color:#eee}.nav>li.disabled>a{color:#777}.nav>li.disabled>a:focus,.nav>li.disabled>a:hover{color:#777;text-decoration:none;background-color:transparent;cursor:not-allowed}.nav .open>a,.nav .open>a:focus,.nav .open>a:hover{background-color:#eee;border-color:#337ab7}.nav .nav-divider{height:1px;margin:9px 0;overflow:hidden;background-color:#e5e5e5}.nav>li>a>img{max-width:none}.nav-tabs{border-bottom:1px solid #ddd}.nav-tabs>li{float:left;margin-bottom:-1px}.nav-tabs>li>a{margin-right:2px;line-height:1.42857143;border:1px solid transparent;border-radius:4px 4px 0 0}.nav-tabs>li>a:hover{border-color:#eee #eee #ddd}.nav-tabs>li.active>a,.nav-tabs>li.active>a:focus,.nav-tabs>li.active>a:hover{color:#555;background-color:#fff;border:1px solid #ddd;border-bottom-color:transparent;cursor:default}.nav-tabs.nav-justified{width:100%;border-bottom:0}.nav-tabs.nav-justified>li{float:none}.nav-tabs.nav-justified>li>a{text-align:center;margin-bottom:5px}.nav-tabs.nav-justified>.dropdown .dropdown-menu{top:auto;left:auto}@media (min-width:768px){.nav-tabs.nav-justified>li{display:table-cell;width:1%}.nav-tabs.nav-justified>li>a{margin-bottom:0}}.nav-tabs.nav-justified>li>a{margin-right:0;border-radius:4px}.nav-tabs.nav-justified>.active>a,.nav-tabs.nav-justified>.active>a:focus,.nav-tabs.nav-justified>.active>a:hover{border:1px solid #ddd}@media (min-width:768px){.nav-tabs.nav-justified>li>a{border-bottom:1px solid #ddd;border-radius:4px 4px 0 0}.nav-tabs.nav-justified>.active>a,.nav-tabs.nav-justified>.active>a:focus,.nav-tabs.nav-justified>.active>a:hover{border-bottom-color:#fff}}.nav-pills>li{float:left}.nav-pills>li>a{border-radius:4px}.nav-pills>li+li{margin-left:2px}.nav-pills>li.active>a,.nav-pills>li.active>a:focus,.nav-pills>li.active>a:hover{color:#fff;background-color:#337ab7}.nav-stacked>li{float:none}.nav-stacked>li+li{margin-top:2px;margin-left:0}.nav-justified{width:100%}.nav-justified>li{float:none}.nav-justified>li>a{text-align:center;margin-bottom:5px}.nav-justified>.dropdown .dropdown-menu{top:auto;left:auto}@media (min-width:768px){.nav-justified>li{display:table-cell;width:1%}.nav-justified>li>a{margin-bottom:0}}.nav-tabs-justified{border-bottom:0}.nav-tabs-justified>li>a{margin-right:0;border-radius:4px}.nav-tabs-justified>.active>a,.nav-tabs-justified>.active>a:focus,.nav-tabs-justified>.active>a:hover{border:1px solid #ddd}@media (min-width:768px){.nav-tabs-justified>li>a{border-bottom:1px solid #ddd;border-radius:4px 4px 0 0}.nav-tabs-justified>.active>a,.nav-tabs-justified>.active>a:focus,.nav-tabs-justified>.active>a:hover{border-bottom-color:#fff}}.tab-content>.tab-pane{display:none}.tab-content>.active{display:block}.nav-tabs .dropdown-menu{margin-top:-1px;border-top-right-radius:0;border-top-left-radius:0}.navbar{position:relative;min-height:50px;margin-bottom:20px;border:1px solid transparent}@media (min-width:768px){.navbar{border-radius:4px}}@media (min-width:768px){.navbar-header{float:left}}.navbar-collapse{overflow-x:visible;padding-right:15px;padding-left:15px;border-top:1px solid transparent;box-shadow:inset 0 1px 0 hsla(0,0%,100%,.1);-webkit-overflow-scrolling:touch}.navbar-collapse.in{overflow-y:auto}@media (min-width:768px){.navbar-collapse{width:auto;border-top:0;box-shadow:none}.navbar-collapse.collapse{display:block!important;height:auto!important;padding-bottom:0;overflow:visible!important}.navbar-collapse.in{overflow-y:visible}.navbar-fixed-bottom .navbar-collapse,.navbar-fixed-top .navbar-collapse,.navbar-static-top .navbar-collapse{padding-left:0;padding-right:0}}.navbar-fixed-bottom .navbar-collapse,.navbar-fixed-top .navbar-collapse{max-height:340px}@media (max-device-width:480px) and (orientation:landscape){.navbar-fixed-bottom .navbar-collapse,.navbar-fixed-top .navbar-collapse{max-height:200px}}.container-fluid>.navbar-collapse,.container-fluid>.navbar-header,.container>.navbar-collapse,.container>.navbar-header{margin-right:-15px;margin-left:-15px}@media (min-width:768px){.container-fluid>.navbar-collapse,.container-fluid>.navbar-header,.container>.navbar-collapse,.container>.navbar-header{margin-right:0;margin-left:0}}.navbar-static-top{z-index:1000;border-width:0 0 1px}@media (min-width:768px){.navbar-static-top{border-radius:0}}.navbar-fixed-bottom,.navbar-fixed-top{position:fixed;right:0;left:0;z-index:1030}@media (min-width:768px){.navbar-fixed-bottom,.navbar-fixed-top{border-radius:0}}.navbar-fixed-top{top:0;border-width:0 0 1px}.navbar-fixed-bottom{bottom:0;margin-bottom:0;border-width:1px 0 0}.navbar-brand{float:left;padding:15px;font-size:18px;line-height:20px;height:50px}.navbar-brand:focus,.navbar-brand:hover{text-decoration:none}.navbar-brand>img{display:block}@media (min-width:768px){.navbar>.container-fluid .navbar-brand,.navbar>.container .navbar-brand{margin-left:-15px}}.navbar-toggle{position:relative;float:right;margin-right:15px;padding:9px 10px;margin-top:8px;margin-bottom:8px;background-color:transparent;background-image:none;border:1px solid transparent;border-radius:4px}.navbar-toggle:focus{outline:0}.navbar-toggle .icon-bar{display:block;width:22px;height:2px;border-radius:1px}.navbar-toggle .icon-bar+.icon-bar{margin-top:4px}@media (min-width:768px){.navbar-toggle{display:none}}.navbar-nav{margin:7.5px -15px}.navbar-nav>li>a{padding-top:10px;padding-bottom:10px;line-height:20px}@media (max-width:767px){.navbar-nav .open .dropdown-menu{position:static;float:none;width:auto;margin-top:0;background-color:transparent;border:0;box-shadow:none}.navbar-nav .open .dropdown-menu .dropdown-header,.navbar-nav .open .dropdown-menu>li>a{padding:5px 15px 5px 25px}.navbar-nav .open .dropdown-menu>li>a{line-height:20px}.navbar-nav .open .dropdown-menu>li>a:focus,.navbar-nav .open .dropdown-menu>li>a:hover{background-image:none}}@media (min-width:768px){.navbar-nav{float:left;margin:0}.navbar-nav>li{float:left}.navbar-nav>li>a{padding-top:15px;padding-bottom:15px}}.navbar-form{margin:8px -15px;padding:10px 15px;border-top:1px solid transparent;border-bottom:1px solid transparent;box-shadow:inset 0 1px 0 hsla(0,0%,100%,.1),0 1px 0 hsla(0,0%,100%,.1)}@media (min-width:768px){.navbar-form .form-group{display:inline-block;margin-bottom:0;vertical-align:middle}.navbar-form .form-control{display:inline-block;width:auto;vertical-align:middle}.navbar-form .form-control-static{display:inline-block}.navbar-form .input-group{display:inline-table;vertical-align:middle}.navbar-form .input-group .form-control,.navbar-form .input-group .input-group-addon,.navbar-form .input-group .input-group-btn{width:auto}.navbar-form .input-group>.form-control{width:100%}.navbar-form .control-label{margin-bottom:0;vertical-align:middle}.navbar-form .checkbox,.navbar-form .radio{display:inline-block;margin-top:0;margin-bottom:0;vertical-align:middle}.navbar-form .checkbox label,.navbar-form .radio label{padding-left:0}.navbar-form .checkbox input[type=checkbox],.navbar-form .radio input[type=radio]{position:relative;margin-left:0}.navbar-form .has-feedback .form-control-feedback{top:0}}@media (max-width:767px){.navbar-form .form-group{margin-bottom:5px}.navbar-form .form-group:last-child{margin-bottom:0}}@media (min-width:768px){.navbar-form{width:auto;border:0;margin-left:0;margin-right:0;padding-top:0;padding-bottom:0;box-shadow:none}}.navbar-nav>li>.dropdown-menu{margin-top:0;border-top-right-radius:0;border-top-left-radius:0}.navbar-fixed-bottom .navbar-nav>li>.dropdown-menu{margin-bottom:0;border-top-right-radius:4px;border-top-left-radius:4px;border-bottom-right-radius:0;border-bottom-left-radius:0}.navbar-btn{margin-top:8px;margin-bottom:8px}.navbar-btn.btn-sm{margin-top:10px;margin-bottom:10px}.navbar-btn.btn-xs{margin-top:14px;margin-bottom:14px}.navbar-text{margin-top:15px;margin-bottom:15px}@media (min-width:768px){.navbar-text{float:left;margin-left:15px;margin-right:15px}}@media (min-width:768px){.navbar-left{float:left!important}.navbar-right{float:right!important;margin-right:-15px}.navbar-right~.navbar-right{margin-right:0}}.navbar-default{background-color:#f8f8f8;border-color:#e7e7e7}.navbar-default .navbar-brand{color:#777}.navbar-default .navbar-brand:focus,.navbar-default .navbar-brand:hover{color:#5e5e5e;background-color:transparent}.navbar-default .navbar-nav>li>a,.navbar-default .navbar-text{color:#777}.navbar-default .navbar-nav>li>a:focus,.navbar-default .navbar-nav>li>a:hover{color:#333;background-color:transparent}.navbar-default .navbar-nav>.active>a,.navbar-default .navbar-nav>.active>a:focus,.navbar-default .navbar-nav>.active>a:hover{color:#555;background-color:#e7e7e7}.navbar-default .navbar-nav>.disabled>a,.navbar-default .navbar-nav>.disabled>a:focus,.navbar-default .navbar-nav>.disabled>a:hover{color:#ccc;background-color:transparent}.navbar-default .navbar-toggle{border-color:#ddd}.navbar-default .navbar-toggle:focus,.navbar-default .navbar-toggle:hover{background-color:#ddd}.navbar-default .navbar-toggle .icon-bar{background-color:#888}.navbar-default .navbar-collapse,.navbar-default .navbar-form{border-color:#e7e7e7}.navbar-default .navbar-nav>.open>a,.navbar-default .navbar-nav>.open>a:focus,.navbar-default .navbar-nav>.open>a:hover{background-color:#e7e7e7;color:#555}@media (max-width:767px){.navbar-default .navbar-nav .open .dropdown-menu>li>a{color:#777}.navbar-default .navbar-nav .open .dropdown-menu>li>a:focus,.navbar-default .navbar-nav .open .dropdown-menu>li>a:hover{color:#333;background-color:transparent}.navbar-default .navbar-nav .open .dropdown-menu>.active>a,.navbar-default .navbar-nav .open .dropdown-menu>.active>a:focus,.navbar-default .navbar-nav .open .dropdown-menu>.active>a:hover{color:#555;background-color:#e7e7e7}.navbar-default .navbar-nav .open .dropdown-menu>.disabled>a,.navbar-default .navbar-nav .open .dropdown-menu>.disabled>a:focus,.navbar-default .navbar-nav .open .dropdown-menu>.disabled>a:hover{color:#ccc;background-color:transparent}}.navbar-default .navbar-link{color:#777}.navbar-default .navbar-link:hover{color:#333}.navbar-default .btn-link{color:#777}.navbar-default .btn-link:focus,.navbar-default .btn-link:hover{color:#333}.navbar-default .btn-link[disabled]:focus,.navbar-default .btn-link[disabled]:hover,fieldset[disabled] .navbar-default .btn-link:focus,fieldset[disabled] .navbar-default .btn-link:hover{color:#ccc}.navbar-inverse{background-color:#222;border-color:#080808}.navbar-inverse .navbar-brand{color:#9d9d9d}.navbar-inverse .navbar-brand:focus,.navbar-inverse .navbar-brand:hover{color:#fff;background-color:transparent}.navbar-inverse .navbar-nav>li>a,.navbar-inverse .navbar-text{color:#9d9d9d}.navbar-inverse .navbar-nav>li>a:focus,.navbar-inverse .navbar-nav>li>a:hover{color:#fff;background-color:transparent}.navbar-inverse .navbar-nav>.active>a,.navbar-inverse .navbar-nav>.active>a:focus,.navbar-inverse .navbar-nav>.active>a:hover{color:#fff;background-color:#080808}.navbar-inverse .navbar-nav>.disabled>a,.navbar-inverse .navbar-nav>.disabled>a:focus,.navbar-inverse .navbar-nav>.disabled>a:hover{color:#444;background-color:transparent}.navbar-inverse .navbar-toggle{border-color:#333}.navbar-inverse .navbar-toggle:focus,.navbar-inverse .navbar-toggle:hover{background-color:#333}.navbar-inverse .navbar-toggle .icon-bar{background-color:#fff}.navbar-inverse .navbar-collapse,.navbar-inverse .navbar-form{border-color:#101010}.navbar-inverse .navbar-nav>.open>a,.navbar-inverse .navbar-nav>.open>a:focus,.navbar-inverse .navbar-nav>.open>a:hover{background-color:#080808;color:#fff}@media (max-width:767px){.navbar-inverse .navbar-nav .open .dropdown-menu>.dropdown-header{border-color:#080808}.navbar-inverse .navbar-nav .open .dropdown-menu .divider{background-color:#080808}.navbar-inverse .navbar-nav .open .dropdown-menu>li>a{color:#9d9d9d}.navbar-inverse .navbar-nav .open .dropdown-menu>li>a:focus,.navbar-inverse .navbar-nav .open .dropdown-menu>li>a:hover{color:#fff;background-color:transparent}.navbar-inverse .navbar-nav .open .dropdown-menu>.active>a,.navbar-inverse .navbar-nav .open .dropdown-menu>.active>a:focus,.navbar-inverse .navbar-nav .open .dropdown-menu>.active>a:hover{color:#fff;background-color:#080808}.navbar-inverse .navbar-nav .open .dropdown-menu>.disabled>a,.navbar-inverse .navbar-nav .open .dropdown-menu>.disabled>a:focus,.navbar-inverse .navbar-nav .open .dropdown-menu>.disabled>a:hover{color:#444;background-color:transparent}}.navbar-inverse .navbar-link{color:#9d9d9d}.navbar-inverse .navbar-link:hover{color:#fff}.navbar-inverse .btn-link{color:#9d9d9d}.navbar-inverse .btn-link:focus,.navbar-inverse .btn-link:hover{color:#fff}.navbar-inverse .btn-link[disabled]:focus,.navbar-inverse .btn-link[disabled]:hover,fieldset[disabled] .navbar-inverse .btn-link:focus,fieldset[disabled] .navbar-inverse .btn-link:hover{color:#444}.clearfix:after,.clearfix:before,.container-fluid:after,.container-fluid:before,.container:after,.container:before,.form-horizontal .form-group:after,.form-horizontal .form-group:before,.nav:after,.nav:before,.navbar-collapse:after,.navbar-collapse:before,.navbar-header:after,.navbar-header:before,.navbar:after,.navbar:before,.row:after,.row:before{content:" ";display:table}.clearfix:after,.container-fluid:after,.container:after,.form-horizontal .form-group:after,.nav:after,.navbar-collapse:after,.navbar-header:after,.navbar:after,.row:after{clear:both}.center-block{display:block;margin-left:auto;margin-right:auto}.pull-right{float:right!important}.pull-left{float:left!important}.hide{display:none!important}.show{display:block!important}.invisible{visibility:hidden}.text-hide{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;border:0}.hidden{display:none!important}.affix{position:fixed}@-ms-viewport{width:device-width}.visible-lg,.visible-lg-block,.visible-lg-inline,.visible-lg-inline-block,.visible-md,.visible-md-block,.visible-md-inline,.visible-md-inline-block,.visible-sm,.visible-sm-block,.visible-sm-inline,.visible-sm-inline-block,.visible-xs,.visible-xs-block,.visible-xs-inline,.visible-xs-inline-block{display:none!important}@media (max-width:767px){.visible-xs{display:block!important}table.visible-xs{display:table!important}tr.visible-xs{display:table-row!important}td.visible-xs,th.visible-xs{display:table-cell!important}}@media (max-width:767px){.visible-xs-block{display:block!important}}@media (max-width:767px){.visible-xs-inline{display:inline!important}}@media (max-width:767px){.visible-xs-inline-block{display:inline-block!important}}@media (min-width:768px) and (max-width:991px){.visible-sm{display:block!important}table.visible-sm{display:table!important}tr.visible-sm{display:table-row!important}td.visible-sm,th.visible-sm{display:table-cell!important}}@media (min-width:768px) and (max-width:991px){.visible-sm-block{display:block!important}}@media (min-width:768px) and (max-width:991px){.visible-sm-inline{display:inline!important}}@media (min-width:768px) and (max-width:991px){.visible-sm-inline-block{display:inline-block!important}}@media (min-width:992px) and (max-width:1199px){.visible-md{display:block!important}table.visible-md{display:table!important}tr.visible-md{display:table-row!important}td.visible-md,th.visible-md{display:table-cell!important}}@media (min-width:992px) and (max-width:1199px){.visible-md-block{display:block!important}}@media (min-width:992px) and (max-width:1199px){.visible-md-inline{display:inline!important}}@media (min-width:992px) and (max-width:1199px){.visible-md-inline-block{display:inline-block!important}}@media (min-width:1200px){.visible-lg{display:block!important}table.visible-lg{display:table!important}tr.visible-lg{display:table-row!important}td.visible-lg,th.visible-lg{display:table-cell!important}}@media (min-width:1200px){.visible-lg-block{display:block!important}}@media (min-width:1200px){.visible-lg-inline{display:inline!important}}@media (min-width:1200px){.visible-lg-inline-block{display:inline-block!important}}@media (max-width:767px){.hidden-xs{display:none!important}}@media (min-width:768px) and (max-width:991px){.hidden-sm{display:none!important}}@media (min-width:992px) and (max-width:1199px){.hidden-md{display:none!important}}@media (min-width:1200px){.hidden-lg{display:none!important}}.visible-print{display:none!important}@media print{.visible-print{display:block!important}table.visible-print{display:table!important}tr.visible-print{display:table-row!important}td.visible-print,th.visible-print{display:table-cell!important}}.visible-print-block{display:none!important}@media print{.visible-print-block{display:block!important}}.visible-print-inline{display:none!important}@media print{.visible-print-inline{display:inline!important}}.visible-print-inline-block{display:none!important}@media print{.visible-print-inline-block{display:inline-block!important}}@media print{.hidden-print{display:none!important}}html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body{font-family:Helvetica Neue,Helvetica,Arial,sans-serif;padding-top:0;min-height:100%;font-size:15px;width:100%;max-width:100%;font-weight:300;background:#fff;color:rgba(0,0,0,.8);letter-spacing:.2px}.inner-container{max-width:700px;margin:0 auto}p{word-wrap:break-word;word-break:normal}dt{margin:15px 0;font-weight:500}dt:before{content:"\266F";left:0;position:absolute;top:auto;color:#ccc}pre{border:none;background-color:#f7f7f7;border-radius:3px;white-space:pre-wrap;font-size:13px;padding:3px 10px}code{background:none!important}code.hljs{display:inline!important}h1{margin-top:25px}h1,h2{margin-bottom:20px}h2{font-size:22px;margin-top:30px;color:#444;padding-bottom:9px}h2,h3{font-weight:400}h3{font-size:20px;margin:20px 0}h4,h5,h6{font-size:18px;margin:15px 0}h1,h2,h3,h4,h5,h6{clear:both}p,pre,ul{margin:0 0 15px}li,p,pre,ul{line-height:1.7}blockquote{font-size:15px}.dropdown:hover .dropdown-menu{display:block;margin-top:0}.plyr__play-large svg{color:#333}.plyr--audio .plyr__controls button.tab-focus:focus,.plyr--audio .plyr__controls button:hover,.plyr__play-large{background:#fff}.m-a-0{margin:0!important}.m-t-0{margin-top:0!important}.m-r-0{margin-right:0!important}.m-b-0{margin-bottom:0!important}.m-l-0{margin-left:0!important}.m-a{margin:20px!important}.m-t{margin-top:20px!important}.m-r{margin-right:20px!important}.m-b{margin-bottom:20px!important}.m-l,.m-x{margin-left:20px!important}.m-x{margin-right:20px!important}.m-y{margin-top:20px!important;margin-bottom:20px!important}.m-x-auto{margin-right:auto!important;margin-left:auto!important}.m-a-xs{margin:10px!important}.m-t-xs{margin-top:10px!important}.m-r-xs{margin-right:10px!important}.m-b-xs{margin-bottom:10px!important}.m-l-xs,.m-x-xs{margin-left:10px!important}.m-x-xs{margin-right:10px!important}.m-y-xs{margin-top:10px!important;margin-bottom:10px!important}.m-a-md{margin:30px!important}.m-t-md{margin-top:30px!important}.m-r-md{margin-right:30px!important}.m-b-md{margin-bottom:30px!important}.m-l-md,.m-x-md{margin-left:30px!important}.m-x-md{margin-right:30px!important}.m-y-md{margin-top:30px!important;margin-bottom:30px!important}.m-a-lg{margin:60px!important}.m-t-lg{margin-top:60px!important}.m-r-lg{margin-right:60px!important}.m-b-lg{margin-bottom:60px!important}.m-l-lg,.m-x-lg{margin-left:60px!important}.m-x-lg{margin-right:60px!important}.m-y-lg{margin-top:60px!important;margin-bottom:60px!important}.p-a-0{padding:0!important}.p-t-0{padding-top:0!important}.p-r-0{padding-right:0!important}.p-b-0{padding-bottom:0!important}.p-l-0{padding-left:0!important}.p-a{padding:20px!important}.p-t{padding-top:20px!important}.p-r{padding-right:20px!important}.p-b{padding-bottom:20px!important}.p-l,.p-x{padding-left:20px!important}.p-x{padding-right:20px!important}.p-y{padding-top:20px!important;padding-bottom:20px!important}.p-x-auto{padding-right:auto!important;padding-left:auto!important}.p-a-xs{padding:10px!important}.p-t-xs{padding-top:10px!important}.p-r-xs{padding-right:10px!important}.p-b-xs{padding-bottom:10px!important}.p-l-xs,.p-x-xs{padding-left:10px!important}.p-x-xs{padding-right:10px!important}.p-y-xs{padding-top:10px!important;padding-bottom:10px!important}.p-a-md{padding:30px!important}.p-t-md{padding-top:30px!important}.p-r-md{padding-right:30px!important}.p-b-md{padding-bottom:30px!important}.p-l-md,.p-x-md{padding-left:30px!important}.p-x-md{padding-right:30px!important}.p-y-md{padding-top:30px!important;padding-bottom:30px!important}.p-a-lg{padding:60px!important}.p-t-lg{padding-top:60px!important}.p-r-lg{padding-right:60px!important}.p-b-lg{padding-bottom:60px!important}.p-l-lg,.p-x-lg{padding-left:60px!important}.p-x-lg{padding-right:60px!important}.p-y-lg{padding-top:60px!important;padding-bottom:60px!important}#toc{padding-top:10px;padding-bottom:10px}#toc .nav>li>a{color:#999;border-left:2px solid transparent;padding:4px 4px 4px 20px;font-size:13px;font-weight:400;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}#toc .nav .nav>li>a{border-left:1px solid transparent;padding-top:1px;padding-bottom:1px;padding-left:30px;font-size:12px}#toc .nav>.active>a,#toc .nav>li>a:focus,#toc .nav>li>a:hover{color:#666;text-decoration:none;background-color:transparent;border-left-color:#999}#toc .nav .nav>.active:focus>a,#toc .nav .nav>.active:hover>a,#toc .nav .nav>.active>a,#toc .nav>.active:focus>a,#toc .nav>.active:hover>a,#toc .nav>.active>a{font-weight:700}#toc .nav ul.nav{display:none}#toc .nav>.active>ul.nav{display:block}#toc .affix{top:10px}#toc .affix-bottom{position:absolute}#toc.affix{top:10px!important;margin-top:0!important}#toc.affix-bottom{position:absolute!important}#toc{background:#f8f8f8}@media (max-width:991px){#toc{display:none!important}}@media (min-width:992px){#toc{width:213px}}@media (min-width:1200px){#toc{width:263px}}#toc h2{background:#79aec8;color:#fff;font-size:14px;text-transform:uppercase;letter-spacing:.5px;padding:5px 15px;margin-bottom:12px;border-bottom:none}.navbar{width:100%;background-color:#fff;border-bottom:1px solid #eee;border-radius:0;margin-bottom:0}.navbar .navbar-brand{color:#333;font-weight:500;font-family:Lora,Georgia,SimSun,Microsoft YaHei,serif}.navbar .nav{float:right}.navbar .nav>li>a{color:#333;font-size:14px}.navbar .navbar-brand,.navbar .navbar-item{height:65px;line-height:35px}.footer{padding-top:40px;padding-bottom:40px;margin-top:100px;color:#767676;text-align:center;border-top:1px solid #e5e5e5;font-size:15px}.footer ul{padding-left:0;list-style:none;margin-bottom:0}.footer li{display:inline}.footer .footer-social{margin-bottom:20px}.footer .footer-links{margin-top:20px}table{display:table;width:100%;border-collapse:collapse;border-spacing:0;overflow:auto;font-size:15px}table caption{text-align:center}table td,table th{padding:6px 13px;border:1px solid #ddd}table tr{background-color:#fff;border-top:1px solid #ccc}table th{font-weight:700}table{margin-bottom:15px}img{max-width:100%}.img-default,img{display:block;margin:0 auto}.img-default{width:75%}.img-center{display:block;margin:0 auto}.img-center .img-title,.img-title{text-align:center}.img-title{font-size:13px;color:rgba(0,0,0,.8);margin-top:3px;margin-bottom:3px}#article img,.note img{max-width:100%;max-height:800px}.note{font-size:15px;background:#fff}.note a{color:#3b94d9}.note h1{font-size:32px;padding-bottom:10px}.note h2{font-size:24px;font-weight:400}.note h3{font-weight:400;font-size:20px}.note h4,.note h5,.note h6{font-size:15px;margin:15px 0}.note .note-content-wrap{border-right:1px solid #fefefe}.note .note-aside{font-size:13px}.note .tocInline{display:none}.readingNote .note{padding:5px 330px 5px 0;position:relative}.readingNote .note blockquote{padding:3px 15px;font-size:15px}.readingNote .note .imageWrapper{position:absolute;z-index:100;top:0;right:0;width:300px}.readingNote .note .imageWrapper img{margin:0 auto;max-height:300px;max-width:270px}.readingNote .note .imageWrapper:before{content:"\27B4"}.section-number{display:none}.pageMeta{margin-bottom:20px;font-size:14px;line-height:18px;color:#999}.pageMeta span{margin-left:2px}.pageMeta span,.pageMeta span a,.pageMeta span i{margin-right:5px}#articleBar.affix{top:0!important;margin-top:0!important;box-shadow:0 1px 3px rgba(0,0,0,.05);border-bottom:none}#articleBar.affix-bottom{position:absolute!important}#articleBar-wrapper{height:50px}#articleBar{width:100%;height:50px;background-color:#fff;border-bottom:1px solid #eee}#articleBar ul{list-style:none;text-align:center;width:100%;margin:0;padding:0}#articleBar ul li{display:inline;margin:0 10px}#articleBar ul li a{display:inline-block;height:50px;padding:15px 0;font-size:14px;text-transform:uppercase;font-weight:700;cursor:pointer;text-decoration:none;color:#71767a}#articleBar ul li.active a{color:#0099e5;border-bottom:2px solid #0099e5}.life #checkpointList{overflow:scroll}.archives .archives-item-list li{list-style:circle;margin:3px 0}.archives .archives-date,.archives .archives-divider{color:#666}.archives .archives-divider{margin:0 3px}body.gallery{font:16px/1.5 Open Sans,Helvetica Neue,Helvetica,arial,sans-serif;font-weight:300;letter-spacing:.1px;padding:0;margin:0;background:#090909;color:#444;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility}.gallery .Collections,.gallery .Posts{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap}.gallery .Collection,.gallery .Post-teaser{width:33.33%;height:250px;background-position:50% 50%;background-size:cover;position:relative}.gallery .Collection .contents,.gallery .Post-teaser .contents{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center;width:100%;height:100%;background:rgba(0,0,0,.8);transition:opacity .25s ease-out;opacity:0;z-index:15;position:absolute;top:0;left:0}.gallery .Collection:hover .contents,.gallery .Post-teaser:hover .contents{opacity:1}.gallery .Collection .contents a,.gallery .Post-teaser .contents a{color:#fff;text-transform:uppercase;text-decoration:none;font-size:.7rem;letter-spacing:1px;border:2px solid hsla(0,0%,100%,.25);padding:10px 25px}.gallery .Collection .contents a:hover,.gallery .Post-teaser .contents a:hover{background:#fff;color:#000;text-decoration:none}.gallery .Exif{position:fixed;top:0;left:0;width:100%;height:100%;display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center;background:rgba(0,0,0,.75);color:hsla(0,0%,100%,.6);transition:all .4s cubic-bezier(.25,.46,.45,.94);pointer-events:none;padding-top:300px;font-size:.85rem;opacity:0;z-index:200}.gallery .Exif.show{padding-top:0;opacity:1;pointer-events:all}.gallery .Exif td:first-child{text-align:right;font-weight:400;padding-right:10px;color:#fff}.gallery .Exif-close{position:absolute;top:50px;right:50px;border:1px solid hsla(0,0%,100%,.3);width:35px;height:35px;line-height:32px;border-radius:50%;text-align:center;font-size:.75rem;color:hsla(0,0%,100%,.5);transition:all .2s}.gallery .Exif-close:hover{border-color:#fff;color:#fff}.gallery footer{font-family:Roboto;padding:50px 25px;font-size:.75rem;display:-ms-flexbox;display:flex}.gallery footer ul{list-style:none;margin-right:25px;-ms-flex:0 0 auto;flex:0 0 auto}.gallery footer ul li.title{font-weight:400;color:#fff}.gallery footer ul:last-child li{width:50%}.gallery .Images{margin:0 75px;-moz-column-gap:25px;column-gap:25px;-moz-column-rule-width:0;column-rule-width:0}.gallery .Image{display:inline-block;margin-bottom:25px;margin-right:25px;position:relative;cursor:zoom-in}.gallery .Image:hover .Image-overlay{opacity:1}.gallery .Image-overlay{opacity:0;pointer-events:none;position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.45);display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center;transition:opacity .25s ease-out}.gallery .Image-overlay:after{display:block;content:"+";color:hsla(0,0%,100%,.95);text-shadow:0 1px 2px #000}.gallery .Image img{width:360px;height:360px;box-shadow:0 5px 10px rgba(0,0,0,.5);background:#111}.gallery .Image:hover{opacity:1!important}.gallery body.light{background:#fff;color:#515151}.gallery body.light .Logo{color:#121212}.gallery body.light .Logo .img>span{background:#121212}.gallery body.light h1,.gallery body.light h2,.gallery body.light h3,.gallery body.light h4{color:#121212;font-weight:400;font-family:Roboto;margin-bottom:10px}.gallery #disqus_thread:before,.gallery body.light h2:before{display:block;border-top:1px dotted #ddd;width:75%;margin:75px auto;content:" "}.gallery body.light h3{margin-top:50px}.gallery body.light a{color:#111;font-weight:400}.gallery body.light a:hover{text-decoration:underline}.gallery body.light footer a{color:#a0a2a4}.gallery body.light footer a:hover{color:#111;text-decoration:none}.gallery body.light footer ul li.title{color:#1c1d21}.gallery .Lightbox{position:fixed;top:0;left:0;z-index:100;width:100%;height:100%;background:rgba(0,0,0,.95);display:none;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center;cursor:zoom-out}.gallery .Lightbox.show{display:-ms-flexbox;display:flex}.gallery .Lightbox img{-ms-flex:0 0 auto;flex:0 0 auto}.gallery .Lightbox img.portrait{height:90%}.gallery .Lightbox img.landscape{width:90%}.gallery body.light .Lightbox{background:hsla(0,0%,100%,.95)}.gallery .Logo{color:#fff;cursor:default;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.gallery .Logo .img{margin:25px auto;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;width:50px;opacity:.75;transform:scale(.5);transition:opacity .25s}.gallery .Logo .img:hover{opacity:1}.gallery .Logo .img>span{width:25px;height:25px;background:#fff}.gallery .Logo .img>span:first-of-type{opacity:.75}.gallery .Logo .img>span:nth-of-type(2){opacity:.5}.gallery .Logo .img>span:nth-of-type(3){opacity:.25}.gallery .Logo .img>span:nth-of-type(4){opacity:.15}.gallery .Logo .name{font-weight:400;font-size:.9rem;letter-spacing:2px}.gallery .Logo .name,.gallery .Logo .text{text-align:center;display:block;text-transform:uppercase}.gallery .Logo .text{font-size:.55rem;letter-spacing:8.6px;opacity:.3}.gallery *{box-sizing:border-box}.gallery img{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.gallery header{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center;height:250px}.gallery a{color:inherit;text-decoration:none}.gallery a:hover{color:#fff}.gallery .Post{max-width:860px;margin:0 auto;padding:0 75px;line-height:1.75;margin-bottom:75px}.gallery .Post img{width:100%;cursor:zoom-in}.gallery .Post-teaser{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center}.gallery .Post-teaser .name{margin:0;width:100%;text-align:center;font-size:.8rem;padding:10px 0;background:hsla(0,0%,100%,.9)}@media screen and (max-width:960px){.gallery .Images{-moz-column-count:1;column-count:1}}@media screen and (min-width:1600px){.gallery .Images{-moz-column-count:4;column-count:4}}@media screen and (min-width:1800px){.gallery .Images{-moz-column-count:5;column-count:5}}body.evernote,html.evernote{height:100%;overflow:hidden;background-color:#fff}.evernote .aside,.evernote .aside-1,.evernote .aside-2,.evernote .container,.evernote .content,.evernote .row-evernote{height:100%}.evernote .aside-1{background-color:#f8f8f8;border-right:1px solid #ececec;padding-left:0;padding-right:0;text-align:center}.evernote .aside-1 a{color:#666;border-radius:0}.evernote .avatar{padding:3px;width:100%;margin-bottom:30px}.evernote .aside-2{border-right:1px solid #ececec;padding-left:10px;padding-right:10px}.evernote .aside-2,.evernote .content{padding-top:20px;overflow-y:auto}.evernote .container{width:100%}.evernote .media{border-bottom:1px solid #ececec;height:72px}.evernote .media .media-heading{font-size:14px}.evernote .media .media-heading a{color:#000}.evernote .media img.media-object{width:40px;max-height:60px}.evernote .last-update{font-size:12px}.evernote .last-update-time a{color:green}.evernote .list-group-item{font-size:14px}.evernote li.active>a,.evernote li.active>a:focus,.evernote li.active>a:hover{color:#666;background-color:#e5e5e5}.timeline-content{border-right:1px solid #ececec}.timeline-content h2{font-size:16px;font-weight:400;height:40px;margin-bottom:5px;line-height:40px}.timeline-content ul{padding:0;margin:0}.timeline-content ul:after{display:block;visibility:hidden;clear:both;height:0;content:".";overflow:hidden}.timeline-content .text{width:125px;height:125px;padding:10px 12px;display:block}.timeline-content .text a{display:block;width:101px;height:105px}.timeline-content li.text{position:relative;float:left;margin:0 6px 6px 0;overflow:hidden;background-color:#ddd;list-style:none}.timeline-content li.text a{line-height:21px;overflow:hidden;padding:0;color:#666;text-decoration:none;outline:none}.timeline-content li.text h3{max-height:42px;line-height:21px;margin:3px 0 13px;overflow:hidden;font-size:16px;font-weight:700}.timeline-content li.text p{word-wrap:break-word;line-height:23px;font-size:12px}.timeline-content li.text .info{position:absolute;top:0;left:0;width:100%;height:100%;text-align:center;color:#fff;z-index:100;opacity:0;background:#353535}.timeline-content li.text .info em{display:block;padding-top:40px;font-size:18px;line-height:40px;font-weight:700;font-style:normal}.timeline-content li.text .info small{font-size:14px}.timeline-content li.text a:hover .info{opacity:.9}.timeline .timeline-month-anchor{text-align:right}.tms-calendar .q1{fill:#d6e685}.tms-calendar .q2{fill:#8cc665}.tms-calendar .q3{fill:#44a340}.tms-calendar .q4{fill:#1e6823}.tms-calendar .q5{fill:#fb8072}.dayClockItems{background:#fff;padding:20px;border-radius:3px;margin-bottom:10px;color:#222;font-size:14px}.dayClockItems .itemStats{padding:0}.dayClockItems .itemStats .week{margin-left:3px;font-size:80%}.dayClockItems .itemStats .info{margin-top:3px}.dayClockItems .itemStats .info,.dayClockItems .itemStats .week{color:#888}.dayClockItems .itemList{padding:0}.dayClockItems .itemList ul{margin:0;padding:0}.dayClockItems .itemList li{list-style:none;padding:5px 10px;border-radius:3px}.dayClockItems .itemList li .time{color:#999;margin-right:15px}.dayClockItems .itemList li .cost{color:#888;font-size:80%}.dayClockItems .itemList li .projectInfo{display:none}.dayClockItems .itemList li .projectInfo .project{margin-right:3px}.dayClockItems .itemList li .projectInfo .text-success{color:#60be29}.dayClockItems .itemList li .projectInfo .label-success{background-color:#60be29}.dayClockItems .itemList li .projectInfo .text-primary{color:#00a0e9}.dayClockItems .itemList li .projectInfo .label-primary{background-color:#00a0e9}.dayClockItems .itemList li .projectInfo .text-danger{color:#e01515}.dayClockItems .itemList li .projectInfo .label-danger{background-color:#e01515}.dayClockItems .itemList li .projectInfo .text-default{color:#ccc}.dayClockItems .itemList li .projectInfo .label-default{background-color:#ccc}.dayClockItems .itemList li.timeGapLg .thing,.dayClockItems .itemList li.timeGapLg .time{color:#fff}.dayClockItems .itemList li.timeGapMd,.dayClockItems .itemList li.timeGapSm{background:#ececec}.dayClockItems .itemList li.timeGapLg{background:#70d445}.dayClockItems .itemList li.clockItem:hover{background:#f4f4f4}.dayClockItems .itemList li.clockItem:hover .cost{display:none}.dayClockItems .itemList li.clockItem:hover .projectInfo{display:inline}.zy-event{background-color:#ddd;margin-right:5px;margin-bottom:5px;width:125px;height:125px;overflow:hidden;padding:5px 8px}.zy-event:hover{background-color:#bbb}.zy-event-head>a{font-size:90%;font-weight:700;color:#74797e;word-break:break-all}.zy-event-body{margin-top:5px}.zy-event-body>p{color:#74797e;word-break:break-all;font-size:80%}.zy-event-info{position:absolute;top:1px;display:none;z-index:-1}.zy-event-info:hover{display:block}.zy-comments{background-color:#fff;margin-top:100px}.items .item-title{font-size:150%}.items ul{list-style:none;padding-left:0}.items li{border-bottom:1px dashed #d9d9d9;padding:10px 0 15px}.todo{color:red}.done{color:green}.timestamp{color:gray}.timestamp-kwd{color:#f59ea0}.tag{background-color:#add8e6;font-weight:400}.target{background-color:#551a8b}span.underline{text-decoration:underline}.center,.figure{text-align:center}.figure{margin:30px 0}.figure p:last-child{font-size:13px;color:rgba(0,0,0,.6);text-align:center}.image-group-name{font-size:13px;color:rgba(0,0,0,.6);margin-bottom:8px}.figure-thumbnail{margin-bottom:7px;margin-right:1px;max-height:150px;box-shadow:0 0 10px rgba(0,0,0,.1)}div.half-left-float,p.half-left-float,table.half-left-float{float:left;width:50%;margin:10px;padding-right:10px}div.half-right-float,p.half-right-float,table.half-right-float{float:right;width:50%;margin:10px;padding-left:10px}.outline-1,.outline-2,.outline-3,.outline-4,.outline-5,.outline-6{clear:both}.hljs-comment,.hljs-quote{color:#8e908c}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#c82829}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5871f}.hljs-attribute{color:#eab700}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#718c00}.hljs-section,.hljs-title{color:#4271ae}.hljs-keyword,.hljs-selector-tag{color:#8959a8}.hljs{display:block;overflow-x:auto;background:#fff;color:#4d4d4c;padding:.5em}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.fancybox-enabled{overflow:hidden}.fancybox-enabled body{overflow:visible;height:100%}.fancybox-is-hidden{position:absolute;top:-9999px;left:-9999px;visibility:hidden}.fancybox-container{position:fixed;top:0;left:0;width:100%;height:100%;z-index:99993;-webkit-tap-highlight-color:transparent;-webkit-backface-visibility:hidden;backface-visibility:hidden;transform:translateZ(0)}.fancybox-container~.fancybox-container{z-index:99992}.fancybox-bg,.fancybox-inner,.fancybox-outer,.fancybox-stage{position:absolute;top:0;right:0;bottom:0;left:0}.fancybox-outer{overflow-y:auto;-webkit-overflow-scrolling:touch}.fancybox-bg{background:#1e1e1e;opacity:0;transition-duration:inherit;transition-property:opacity;transition-timing-function:cubic-bezier(.47,0,.74,.71)}.fancybox-is-open .fancybox-bg{opacity:.87;transition-timing-function:cubic-bezier(.22,.61,.36,1)}.fancybox-caption-wrap,.fancybox-infobar,.fancybox-toolbar{position:absolute;direction:ltr;z-index:99997;opacity:0;visibility:hidden;transition:opacity .25s,visibility 0s linear .25s;box-sizing:border-box}.fancybox-show-caption .fancybox-caption-wrap,.fancybox-show-infobar .fancybox-infobar,.fancybox-show-toolbar .fancybox-toolbar{opacity:1;visibility:visible;transition:opacity .25s,visibility 0s}.fancybox-infobar{top:0;left:50%;margin-left:-79px}.fancybox-infobar__body{display:inline-block;width:70px;line-height:44px;font-size:13px;font-family:Helvetica Neue,Helvetica,Arial,sans-serif;text-align:center;color:#ddd;background-color:rgba(30,30,30,.7);pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-touch-callout:none;-webkit-tap-highlight-color:transparent;-webkit-font-smoothing:subpixel-antialiased}.fancybox-toolbar{top:0;right:0}.fancybox-stage{overflow:hidden;direction:ltr;z-index:99994;-webkit-transform:translateZ(0)}.fancybox-slide{position:absolute;top:0;left:0;width:100%;height:100%;margin:0;padding:0;overflow:auto;outline:none;white-space:normal;box-sizing:border-box;text-align:center;z-index:99994;-webkit-overflow-scrolling:touch;display:none;-webkit-backface-visibility:hidden;backface-visibility:hidden;transition-property:transform,opacity;transform-style:preserve-3d}.fancybox-slide:before{content:"";display:inline-block;vertical-align:middle;height:100%;width:0}.fancybox-is-sliding .fancybox-slide,.fancybox-slide--current,.fancybox-slide--next,.fancybox-slide--previous{display:block}.fancybox-slide--image{overflow:visible}.fancybox-slide--image:before{display:none}.fancybox-slide--video .fancybox-content,.fancybox-slide--video iframe{background:#000}.fancybox-slide--map .fancybox-content,.fancybox-slide--map iframe{background:#e5e3df}.fancybox-slide--next{z-index:99995}.fancybox-slide>div{display:inline-block;position:relative;padding:24px;margin:44px 0;border-width:0;vertical-align:middle;text-align:left;background-color:#fff;overflow:auto;box-sizing:border-box}.fancybox-slide .fancybox-image-wrap{position:absolute;top:0;left:0;margin:0;padding:0;border:0;z-index:99995;background:transparent;cursor:default;overflow:visible;transform-origin:top left;background-size:100% 100%;background-repeat:no-repeat;-webkit-backface-visibility:hidden;backface-visibility:hidden;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.fancybox-can-zoomOut .fancybox-image-wrap{cursor:zoom-out}.fancybox-can-zoomIn .fancybox-image-wrap{cursor:zoom-in}.fancybox-can-drag .fancybox-image-wrap{cursor:-webkit-grab;cursor:grab}.fancybox-is-dragging .fancybox-image-wrap{cursor:-webkit-grabbing;cursor:grabbing}.fancybox-image,.fancybox-spaceball{position:absolute;top:0;left:0;width:100%;height:100%;margin:0;padding:0;border:0;max-width:none;max-height:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.fancybox-spaceball{z-index:1}.fancybox-slide--iframe .fancybox-content{padding:0;width:80%;height:80%;max-width:calc(100% - 100px);max-height:calc(100% - 88px);overflow:visible;background:#fff}.fancybox-iframe{display:block;padding:0;border:0;height:100%}.fancybox-error,.fancybox-iframe{margin:0;width:100%;background:#fff}.fancybox-error{padding:40px;max-width:380px;cursor:default}.fancybox-error p{margin:0;padding:0;color:#444;font:16px/20px Helvetica Neue,Helvetica,Arial,sans-serif}.fancybox-close-small{position:absolute;top:0;right:0;width:44px;height:44px;padding:0;margin:0;border:0;border-radius:0;outline:none;background:transparent;z-index:10;cursor:pointer}.fancybox-close-small:after{content:"\D7";position:absolute;top:5px;right:5px;width:30px;height:30px;font:20px/30px Arial,Helvetica Neue,Helvetica,sans-serif;color:#888;font-weight:300;text-align:center;border-radius:50%;border-width:0;background:#fff;transition:background .25s;box-sizing:border-box;z-index:2}.fancybox-close-small:focus:after{outline:1px dotted #888}.fancybox-close-small:hover:after{color:#555;background:#eee}.fancybox-slide--iframe .fancybox-close-small{top:0;right:-44px}.fancybox-slide--iframe .fancybox-close-small:after{background:transparent;font-size:35px;color:#aaa}.fancybox-slide--iframe .fancybox-close-small:hover:after{color:#fff}.fancybox-caption-wrap{bottom:0;left:0;right:0;padding:60px 30px 0;background:linear-gradient(180deg,transparent,rgba(0,0,0,.1) 20%,rgba(0,0,0,.2) 40%,rgba(0,0,0,.6) 80%,rgba(0,0,0,.8));pointer-events:none}.fancybox-caption{padding:30px 0;border-top:1px solid hsla(0,0%,100%,.4);font-size:14px;font-family:Helvetica Neue,Helvetica,Arial,sans-serif;color:#fff;line-height:20px;-webkit-text-size-adjust:none}.fancybox-caption a,.fancybox-caption button,.fancybox-caption select{pointer-events:all}.fancybox-caption a{color:#fff;text-decoration:underline}.fancybox-button{display:inline-block;position:relative;margin:0;padding:0;border:0;width:44px;height:44px;line-height:44px;text-align:center;background:transparent;color:#ddd;border-radius:0;cursor:pointer;vertical-align:top;outline:none}.fancybox-button[disabled]{cursor:default;pointer-events:none}.fancybox-button,.fancybox-infobar__body{background:rgba(30,30,30,.6)}.fancybox-button:hover:not([disabled]){color:#fff;background:rgba(0,0,0,.8)}.fancybox-button:after,.fancybox-button:before{content:"";pointer-events:none;position:absolute;background-color:currentColor;color:currentColor;opacity:.9;box-sizing:border-box;display:inline-block}.fancybox-button[disabled]:after,.fancybox-button[disabled]:before{opacity:.3}.fancybox-button--left:after,.fancybox-button--right:after{top:18px;width:6px;height:6px;background:transparent;border-top:2px solid currentColor;border-right:2px solid currentColor}.fancybox-button--left:after{left:20px;transform:rotate(-135deg)}.fancybox-button--right:after{right:20px;transform:rotate(45deg)}.fancybox-button--left{border-bottom-left-radius:5px}.fancybox-button--right{border-bottom-right-radius:5px}.fancybox-button--close:after,.fancybox-button--close:before{content:"";display:inline-block;position:absolute;height:2px;width:16px;top:calc(50% - 1px);left:calc(50% - 8px)}.fancybox-button--close:before{transform:rotate(45deg)}.fancybox-button--close:after{transform:rotate(-45deg)}.fancybox-arrow{position:absolute;top:50%;margin:-50px 0 0;height:100px;width:54px;padding:0;border:0;outline:none;background:none;cursor:pointer;z-index:99995;opacity:0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;transition:opacity .25s}.fancybox-arrow:after{content:"";position:absolute;top:28px;width:44px;height:44px;background-color:rgba(30,30,30,.8);background-image:url(data:image/svg+xml;base64,PHN2ZyBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjQ4IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSI0OCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4gICAgPHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPiAgICA8cGF0aCBkPSJNMTIgNGwtMS40MSAxLjQxTDE2LjE3IDExSDR2MmgxMi4xN2wtNS41OCA1LjU5TDEyIDIwbDgtOHoiLz48L3N2Zz4=);background-repeat:no-repeat;background-position:50%;background-size:24px 24px}.fancybox-arrow--right{right:0}.fancybox-arrow--left{left:0;transform:scaleX(-1)}.fancybox-arrow--left:after,.fancybox-arrow--right:after{left:0}.fancybox-show-nav .fancybox-arrow{opacity:.6}.fancybox-show-nav .fancybox-arrow[disabled]{opacity:.3}.fancybox-slide>.fancybox-loading{border:6px solid rgba(99,99,99,.4);border-top:6px solid hsla(0,0%,100%,.6);border-radius:100%;height:50px;width:50px;animation:a .8s infinite linear;background:transparent;position:absolute;top:50%;left:50%;margin-top:-25px;margin-left:-25px;z-index:99999}@keyframes a{0%{transform:rotate(0deg)}to{transform:rotate(359deg)}}.fancybox-animated{transition-timing-function:cubic-bezier(0,0,.25,1)}.fancybox-fx-slide.fancybox-slide--previous{transform:translate3d(-100%,0,0);opacity:0}.fancybox-fx-slide.fancybox-slide--next{transform:translate3d(100%,0,0);opacity:0}.fancybox-fx-slide.fancybox-slide--current{transform:translateZ(0);opacity:1}.fancybox-fx-fade.fancybox-slide--next,.fancybox-fx-fade.fancybox-slide--previous{opacity:0;transition-timing-function:cubic-bezier(.19,1,.22,1)}.fancybox-fx-fade.fancybox-slide--current{opacity:1}.fancybox-fx-zoom-in-out.fancybox-slide--previous{transform:scale3d(1.5,1.5,1.5);opacity:0}.fancybox-fx-zoom-in-out.fancybox-slide--next{transform:scale3d(.5,.5,.5);opacity:0}.fancybox-fx-zoom-in-out.fancybox-slide--current{transform:scaleX(1);opacity:1}.fancybox-fx-rotate.fancybox-slide--previous{transform:rotate(-1turn);opacity:0}.fancybox-fx-rotate.fancybox-slide--next{transform:rotate(1turn);opacity:0}.fancybox-fx-rotate.fancybox-slide--current{transform:rotate(0deg);opacity:1}.fancybox-fx-circular.fancybox-slide--previous{transform:scale3d(0,0,0) translate3d(-100%,0,0);opacity:0}.fancybox-fx-circular.fancybox-slide--next{transform:scale3d(0,0,0) translate3d(100%,0,0);opacity:0}.fancybox-fx-circular.fancybox-slide--current{transform:scaleX(1) translateZ(0);opacity:1}.fancybox-fx-tube.fancybox-slide--previous{transform:translate3d(-100%,0,0) scale(.1) skew(-10deg)}.fancybox-fx-tube.fancybox-slide--next{transform:translate3d(100%,0,0) scale(.1) skew(10deg)}.fancybox-fx-tube.fancybox-slide--current{transform:translateZ(0) scale(1)}@media (max-width:800px){.fancybox-infobar{left:0;margin-left:0}.fancybox-button--left,.fancybox-button--right{display:none!important}.fancybox-caption{padding:20px 0;margin:0}}.fancybox-button--fullscreen:before{width:15px;height:11px;left:calc(50% - 7px);top:calc(50% - 6px);border:2px solid;background:none}.fancybox-button--pause:before,.fancybox-button--play:before{top:calc(50% - 6px);left:calc(50% - 4px);background:transparent}.fancybox-button--play:before{width:0;height:0;border-top:6px inset transparent;border-bottom:6px inset transparent;border-left:10px solid;border-radius:1px}.fancybox-button--pause:before{width:7px;height:11px;border-style:solid;border-width:0 2px}.fancybox-button--thumbs,.fancybox-thumbs{display:none}@media (min-width:800px){.fancybox-button--thumbs{display:inline-block}.fancybox-button--thumbs span{font-size:23px}.fancybox-button--thumbs:before{width:3px;height:3px;top:calc(50% - 2px);left:calc(50% - 2px);box-shadow:0 -4px 0,-4px -4px 0,4px -4px 0,inset 0 0 0 32px,-4px 0 0,4px 0 0,0 4px 0,-4px 4px 0,4px 4px 0}.fancybox-thumbs{position:absolute;top:0;right:0;bottom:0;left:auto;width:220px;margin:0;padding:5px 5px 0 0;background:#fff;word-break:normal;-webkit-tap-highlight-color:transparent;-webkit-overflow-scrolling:touch;-ms-overflow-style:-ms-autohiding-scrollbar;box-sizing:border-box;z-index:99995}.fancybox-show-thumbs .fancybox-thumbs{display:block}.fancybox-show-thumbs .fancybox-inner{right:220px}.fancybox-thumbs>ul{list-style:none;position:absolute;position:relative;width:100%;height:100%;margin:0;padding:0;overflow-x:hidden;overflow-y:auto;font-size:0}.fancybox-thumbs>ul>li{float:left;overflow:hidden;max-width:50%;padding:0;margin:0;width:105px;height:75px;position:relative;cursor:pointer;outline:none;border:5px solid transparent;border-top-width:0;border-right-width:0;-webkit-tap-highlight-color:transparent;-webkit-backface-visibility:hidden;backface-visibility:hidden;box-sizing:border-box}li.fancybox-thumbs-loading{background:rgba(0,0,0,.1)}.fancybox-thumbs>ul>li>img{position:absolute;top:0;left:0;min-width:100%;min-height:100%;max-width:none;max-height:none;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.fancybox-thumbs>ul>li:before{content:"";position:absolute;top:0;right:0;bottom:0;left:0;border-radius:2px;border:4px solid #4ea7f9;z-index:99991;opacity:0;transition:all .2s cubic-bezier(.25,.46,.45,.94)}.fancybox-thumbs>ul>li.fancybox-thumbs-active:before{opacity:1}}</style></head><body><div id="react-mount"><div data-reactroot="" data-reactid="1" data-react-checksum="1691794597"><nav class="navbar" id="header" data-reactid="2"><div class="container" data-reactid="3"><div class="navbar-header" data-reactid="4"><a class="navbar-brand" href="/" data-reactid="5">仲之地</a></div><div class="navbar-collapse collapse bs-navbar-collapse" data-reactid="6"><ul class="nav navbar-nav" data-reactid="7"><li data-reactid="8"><!-- react-text: 9 --> <!-- /react-text --><a class="navbar-item" href="/blog/" data-reactid="10">Blog</a><!-- react-text: 11 --> <!-- /react-text --></li><li data-reactid="12"><!-- react-text: 13 --> <!-- /react-text --><a class="navbar-item" href="/notes/" data-reactid="14">笔记</a><!-- react-text: 15 --> <!-- /react-text --></li><li data-reactid="16"><!-- react-text: 17 --> <!-- /react-text --><a class="navbar-item" href="/archives/" data-reactid="18">归档</a><!-- react-text: 19 --> <!-- /react-text --></li><li data-reactid="20"><!-- react-text: 21 --> <!-- /react-text --><a class="navbar-item" href="/timeline/" data-reactid="22">时间线</a><!-- react-text: 23 --> <!-- /react-text --></li><li data-reactid="24"><!-- react-text: 25 --> <!-- /react-text --><a class="navbar-item" href="/reading/notes/" data-reactid="26">读书笔记</a><!-- react-text: 27 --> <!-- /react-text --></li><li data-reactid="28"><!-- react-text: 29 --> <!-- /react-text --><a class="navbar-item" href="/about/" data-reactid="30">关于</a><!-- react-text: 31 --> <!-- /react-text --></li></ul></div></div></nav><div class="container m-t" data-reactid="32"><div class="note" data-reactid="33"><!-- react-empty: 34 --><h1 data-reactid="35">Flask Web 框架</h1><div class="pageMeta" data-reactid="36"><span data-reactid="37">2014-08-29</span></div><div class="row" data-reactid="38"><div class="col-md-9" data-reactid="39"><div data-reactid="40"><div class="tocInline"><h2>目录</h2><ul class="nav-toc"><li><a href="#1"><span class="section-number">1</span>Introduction</a></li>
<li><a href="#2"><span class="section-number">2</span>资料搜集</a><ul class="nav-toc"><li><a href="#2-1"><span class="section-number">2.1</span>Flask Blog</a></li>
<li><a href="#2-2"><span class="section-number">2.2</span>Flask BB</a></li>
<li><a href="#2-3"><span class="section-number">2.3</span>谁在使用 Flask？</a></li>
</ul>
</li>
<li><a href="#3"><span class="section-number">3</span>学习 Flask 文档</a><ul class="nav-toc"><li><a href="#3-1"><span class="section-number">3.1</span>官方文档</a></li>
<li><a href="#3-2"><span class="section-number">3.2</span>The Flask Mega-Tutorial</a></li>
<li><a href="#3-3"><span class="section-number">3.3</span>Flask Web Development</a></li>
</ul>
</li>
<li><a href="#4"><span class="section-number">4</span>阅读 Flask 源码</a><ul class="nav-toc"><li><a href="#4-1"><span class="section-number">4.1</span>源码总览和阅读意义</a></li>
<li><a href="#4-2"><span class="section-number">4.2</span>app.py</a></li>
</ul>
</li>
<li><a href="#5"><span class="section-number">5</span>Flask 扩展</a><ul class="nav-toc"><li><a href="#20151206"><span class="section-number">20151206</span>我的 Python Flask 依赖库列表 &#60;2015-12-06 日&#62;</a></li>
<li><a href="#5-2"><span class="section-number">5.2</span>Flask-Admin</a></li>
<li><a href="#5-3"><span class="section-number">5.3</span>WTForms</a></li>
<li><a href="#5-4"><span class="section-number">5.4</span>WTForms-Components</a></li>
<li><a href="#5-5"><span class="section-number">5.5</span>Flash-Script</a></li>
<li><a href="#5-6"><span class="section-number">5.6</span>Flask-Bootstrap</a></li>
<li><a href="#5-7"><span class="section-number">5.7</span>Flask-SQLAlchemy </a></li>
</ul>
</li>
<li><a href="#6"><span class="section-number">6</span>URL 路由和请求处理</a><ul class="nav-toc"><li><a href="#6-1"><span class="section-number">6.1</span>如何处理 GET 方式的 search?query=xxx 形式的 URL？</a></li>
<li><a href="#6-2"><span class="section-number">6.2</span>如何处理 POST 方式的参数在 post data 里的情况？</a></li>
<li><a href="#6-3"><span class="section-number">6.3</span>URL 中带有 &#39;/&#39; 时该如何路由？</a></li>
<li><a href="#6-4"><span class="section-number">6.4</span>如何向后端 POST 参数格式为 JSON 的请求？</a></li>
<li><a href="#6-5"><span class="section-number">6.5</span>Flask 处理 404 和 500 错误码</a></li>
</ul>
</li>
<li><a href="#7"><span class="section-number">7</span>Cookies and Sessions</a><ul class="nav-toc"><li><a href="#7-1"><span class="section-number">7.1</span>每次请求前通过 Cookies 获取用户名</a></li>
</ul>
</li>
<li><a href="#8"><span class="section-number">8</span>Http Client</a><ul class="nav-toc"><li><a href="#8-1"><span class="section-number">8.1</span>使用 Requests</a></li>
</ul>
</li>
<li><a href="#9"><span class="section-number">9</span>异步，多线程，后台任务相关</a><ul class="nav-toc"><li><a href="#9-1"><span class="section-number">9.1</span>使用 Celery</a></li>
</ul>
</li>
<li><a href="#10"><span class="section-number">10</span>Jinja 相关</a><ul class="nav-toc"><li><a href="#10-1"><span class="section-number">10.1</span>使用 macro 来快速实现带表单的 Modal（模态窗口）</a></li>
<li><a href="#10-2"><span class="section-number">10.2</span>在 Jinja 模板文件中调用 Python 函数</a></li>
<li><a href="#20151209"><span class="section-number">20151209</span>Filters in Jinja2 &#60;2015-12-09 三&#62;</a></li>
</ul>
</li>
<li><a href="#11"><span class="section-number">11</span>Cache</a><ul class="nav-toc"><li><a href="#11-1"><span class="section-number">11.1</span>一个简单的 Cache 实现</a></li>
<li><a href="#11-2"><span class="section-number">11.2</span>利用 Flask-Cache 来 Cache 某个 View Function</a></li>
</ul>
</li>
<li><a href="#12"><span class="section-number">12</span>数据库相关</a><ul class="nav-toc"><li><a href="#12-1"><span class="section-number">12.1</span>忠告</a></li>
<li><a href="#12-2"><span class="section-number">12.2</span>如何做数据库迁移</a></li>
<li><a href="#12-3"><span class="section-number">12.3</span>如何在 Flask App 外部使用 Flask-SQLAlchemy？</a></li>
<li><a href="#20150309"><span class="section-number">20150309</span>在 Flask 下使用 SQLite  &#60;2015-03-09 一&#62;</a></li>
<li><a href="#12-5"><span class="section-number">12.5</span>Multiple Databases</a></li>
</ul>
</li>
<li><a href="#13"><span class="section-number">13</span>Flask 部署</a></li>
<li><a href="#14"><span class="section-number">14</span>Miscellaneous</a><ul class="nav-toc"><li><a href="#14-1"><span class="section-number">14.1</span>处理 Ajax</a></li>
<li><a href="#14-2"><span class="section-number">14.2</span>邮件</a></li>
<li><a href="#14-3"><span class="section-number">14.3</span>在 Flask 里使用 Redis</a></li>
<li><a href="#14-4"><span class="section-number">14.4</span>Angular.js with Flask</a></li>
</ul>
</li>
<li><a href="#15"><span class="section-number">15</span>RESTful API</a></li>
<li><a href="#16"><span class="section-number">16</span>回顾</a><ul class="nav-toc"><li><a href="#20140920"><span class="section-number">20140920</span>Flask 是个比 Tornado 更加理想的 Web 框架 &#60;2014-09-20 六&#62;</a></li>
</ul>
</li>
</ul>
</div><h2 id="1"><span class="section-number">1</span>Introduction</h2>
<p>Tornado 用了大半年，有些不爽的地方，主要在于 Tornado 太自由了，无法在所谓的 &#34;最佳
实践&#34; 上给我指导。想换回 Django，但一想到它的 ORM 和 Template System，我又产生了
抗拒之心。于是，我想到了 Flask。</p>
<p>Flask 是著名的 Pocoo 团队出品的 Python Web 框架。</p>
<h2 id="2"><span class="section-number">2</span>资料搜集</h2>
<ul><li><a href="http://flask.pocoo.org/snippets/">Flash Snippets</a></li>
<li><a href="http://python-china.org/topic/93">flask 的优点是什么？</a></li>
<li><a href="http://neue.v2ex.com/t/28701">有没有用 Flask 做的比较大的开源项目？</a></li>
<li><a href="http://www.reddit.com/r/Python/comments/1phog0/im_writing_a_web_app_flask_tornado_and_would/">Expert&#39;s opinion on best practices about python web</a></li>
<li><a href="http://kochiya.me/www/posts/%25E4%25BB%258Eflaskbb,june%25E5%2588%25B0lolipop%25EF%25BC%2588%25E4%25B8%2580%25EF%25BC%2589.html">从 flaskbb,june 到 lolipop</a></li>
</ul>
<h3 id="2-1"><span class="section-number">2.1</span>Flask Blog</h3>
<ul><li><a href="http://blog.miguelgrinberg.com/post/about-this-blog"><a href="http://blog.miguelgrinberg.com/post/about-this-blog">http://blog.miguelgrinberg.com/post/about-this-blog</a></a></li>
<li><a href="http://www.jamesharding.ca/posts/simple-static-markdown-blog-in-flask/">Build a Simple, Static, Markdown-Powered Blog with Flask</a></li>
</ul>
<h3 id="2-2"><span class="section-number">2.2</span>Flask BB</h3>
<ul><li>配置模块是 flaskbb.configs</li>
</ul>
<h3 id="2-3"><span class="section-number">2.3</span>谁在使用 Flask？</h3>
<ul><li><a href="https://bitbucket.org/thomaswaldmann/moin-2.0">MoinMoin - a wiki engine in Python</a> </li>
</ul>
<h2 id="3"><span class="section-number">3</span>学习 Flask 文档</h2>
<h3 id="3-1"><span class="section-number">3.1</span>官方文档</h3>
<ul><li><a href="http://dormousehole.readthedocs.org/en/latest/index.html">Flask 中文文档</a></li>
</ul>
<p>virtualenv 是个好东西，解决了广受诟病的 Python 部署的环境依赖问题。在 virtualenv 下安
装 Flask：</p>
<ol><li>sudo pip install virtualenv</li>
<li>. venv/bin/activate</li>
<li>sudo pip install Flask<p></p>
</li>
</ol>
<p>打开调试模式（不需要每次修改代码后都重启 Flask），这个功能真赞啊。</p>
<pre class="prettyprint"><code class="language-python">app.run(debug=True)</code>
</pre>
<p>另外，打开调试模式后，还可以获得另外的好处，就是出错时，能在网页上弹出非常详细的
错误调试信息，让开发者能快速定位错误，而且还能在 Web 上直接调试！再次好顶赞啊！不
过要记住， <b>生产环境下不能打开调试模式</b> 。</p>
<p>Flask 默认使用 Jinja2 模板，相对 Tornado，它加入了很多便利的措施。如：</p>
<ol><li>直接可以调用 render_template 来渲染 Jinja2 模板。</li>
<li>模板内部可以直接访问 request，session，g 对象和 get_flashed_messages() 函数。<p></p>
</li>
</ol>
<p>request 对象如同 Tornado 的 self.request 一样。由它可以通过 key 获取表单的各个
value，如果 key 不存在，会抛出个 KeyError 的异常。如果不捕捉，会弹出 400（请求出
错）页面，用户可能会略有不爽。如果通过 request.args.get(&#39;key&#39;, &#39;&#39;) 来获取的话，则
会好一点。</p>
<p>session 对象可以用来在不同的请求间传递信息，这点类似于 Cookie。但是 session 可以
加密，没有密钥的话，用户无法修改它。session 和 request 一样，都是内置变量。</p>
<p>消息闪现，日志和部署。我发现 Flask 可以用过 Tornado 部署，这个很赞，我打喜欢在
Web 服务器上直接部署，我喜欢部署在 WSGI 容器里，通过反向代理的这种部署方式。</p>
<p>应用环境。。。</p>
<p>请求环境。。。</p>
<h3 id="3-2"><span class="section-number">3.2</span>The Flask Mega-Tutorial</h3>
<ul><li><a href="http://www.pythondoc.com/flask-mega-tutorial/index.html">The Flask Mega-Tutorial (zh_cn)</a></li>
<li><a href="https://github.com/miguelgrinberg/flasky"><a href="https://github.com/miguelgrinberg/flasky">https://github.com/miguelgrinberg/flasky</a></a><p></p>
</li>
</ul>
<p>这篇教程里的 Web 表单一章介绍了使用 Flask-WTF 扩展来快捷地实现表单。</p>
<ul><li><a href="http://www.pythondoc.com/flask-mega-tutorial/webforms.html">Web 表单</a></li>
</ul>
<p>另外，官方文档里也提到用 WTForms 来实现表单验证。
+<a href="http://dormousehole.readthedocs.org/en/latest/patterns/wtforms.html">使用 WTForms 进行表单验证</a></p>
<h3 id="3-3"><span class="section-number">3.3</span>Flask Web Development</h3>
<h4 id="3-3-1"><span class="section-number">3.3.1</span>第二章：Basic Application Structure</h4>
<p>主要关注</p>
<h4 id="3-3-2"><span class="section-number">3.3.2</span>第七章：</h4>
<p>看完了 app 的_init_.py 的实现方式，但是蓝图和 manager.py 以及 make_shell_context()，
requiremens.txt，unittest 还没看，等以后要用到再看。</p>
<h2 id="4"><span class="section-number">4</span>阅读 Flask 源码</h2>
<h3 id="4-1"><span class="section-number">4.1</span>源码总览和阅读意义</h3>
<p>通过阅读 Flask 的源码，我想知道或者获得：</p>
<ul><li>Web 框架实现 URL 分发，参数解析，Session 支持等功能的原理。</li>
<li>Flask 是如何支持扩展的。</li>
<li>从源码角度学习 Flask 的功能和用法</li>
<li>以后我用 Flask 出问题，我想更轻易地排查出问题原因。</li>
</ul>
<p>Flask 0.10.1 的源码有 5345 行，而 Tornado 的源码有 15811 行，Flask 依赖的
Werkzeug 则有 14622 行。Tornado 比 Flask 源码多这么多的原因是 Tornado 实现了 一个
Http Server，以及 IO Loop，Http Client 等，而 Flask 是个纯粹的 Web 框架，大量依赖
其他 Python 库，甚至连 Route 功能都是由 Werkzeug 提供的。由此也已看出，用 Python
开发出一个 Web 框架在技术上是件很容易的事情。</p>
<h3 id="4-2"><span class="section-number">4.2</span>app.py</h3>
<p>该文件实现了主类 Flask，Flask 开头定义了几个配置项，如 DEBUG，TESTTING，
SECRET_KEY 等，并为它们设置了缺省值。</p>
<p><b>route()</b> 方法定义在 Flask 类里，以修饰器的方式来将一个 View Function 注册给一个 URL
Rule。在内部的 decorator() 函数中是调用 self.add_url_rule(rule, endpoint, f,
**options) 来实现真正的注册。</p>
<p><b>add_url_rule()</b> 方法负责 生成 Rule，然后加入到 url_map 中。这两步涉及到的 Rule 和
Map 其实是 werkzeug.routing 提供的， 不过从 Endpoint 到 View Function 的映射是由
Flask 来维护的（Endpoint 就是路由的终点，是 werkzeug 定义的概念，Flask 沿用）。</p>
<p><b>dispatch_request()</b> 函数在执行之前，路由过程就已经完成（其实是由
werkzeug.routing 来完成的）。 如果之前的路由出错了，在这个函数里会执行路由异常过
程。在这个的末尾会调用真正的 View Function，也就是用户自己定义的部分。</p>
<h2 id="5"><span class="section-number">5</span>Flask 扩展</h2>
<h3 id="20151206"><span class="section-number">20151206</span>我的 Python Flask 依赖库列表 &#60;2015-12-06 日&#62;</h3>
<p>Flask 扩展：</p>
<pre>pip install flask
pip install Flask-Script
pip install Flask-Migrate # SQLAlchemy 数据库迁移工具
pip install flask-bootstrap # Flask 和 Bootstrap 集成
pip install flask-admin # Flask admin 工具
pip install flask-restful # 用于开发 RESTful API
pip install Flask-WTF # Flask 和 WTForms 集成</pre>
<p></p>
<p>此外，还有一些通用的 Python 库：</p>
<pre>pip install requests # 易用的 Python HTTP 库
pip install tornado # Tornado Web Server 和异步的 HTTP Client
pip install pycurl # Libcurl 的 Python 接口
pip install suds # 轻量级的 SOAP 客户端
pip install redis # Python 的 Redis 客户端
pip install MySQL-python
pip install gunicorn</pre>
<p>还有一些依赖没有列出，因为是上述依赖的子依赖。这里有个全集（2015-12-06），
后续可能还有增减。</p>
<pre>Flask==0.10.1
Flask-Admin==1.3.0
Flask-Bootstrap==3.3.5.7
Flask-Migrate==1.6.0
Flask-RESTful==0.3.4
Flask-SQLAlchemy==2.1
Flask-Script==2.0.5
Flask-WTF==0.12
Jinja2==2.8
Mako==1.0.3
MarkupSafe==0.23
MySQL-python==1.2.5
SQLAlchemy==1.0.9
WTForms==2.0.2
Werkzeug==0.11.2
alembic==0.8.3
aniso8601==1.1.0
backports-abc==0.4
backports.ssl-match-hostname==3.4.0.2
certifi==2015.11.20.1
dominate==2.1.16
gunicorn==19.4.1
itsdangerous==0.24
pycurl==7.19.5.3
python-dateutil==2.4.2
python-editor==0.5
pytz==2015.7
redis==2.10.5
requests==2.8.1
singledispatch==3.4.0.3
six==1.10.0
suds==0.4
tornado==4.3
visitor==0.1.2
wsgiref==0.1.2</pre>
<h3 id="5-2"><span class="section-number">5.2</span>Flask-Admin</h3>
<ul><li><a href="http://flask-admin.readthedocs.org/en/latest/">Flask-Admin 文档</a> </li>
</ul>
<p>用法：</p>
<h3 id="5-3"><span class="section-number">5.3</span>WTForms</h3>
<ul><li><a href="http://dormousehole.readthedocs.org/en/latest/patterns/wtforms.html">使用 WTForms 进行表单验证</a></li>
<li><a href="http://wtforms.readthedocs.org/en/latest/index.html">WTForms Documentation</a></li>
<li><a href="http://www.pythondoc.com/flask-mega-tutorial/webforms.html">The Flask Mega-Tutorial: Web 表单</a></li>
<li><a href="http://dormousehole.readthedocs.org/en/latest/patterns/wtforms.html">Jinja2 下的 macro：render_field</a></li>
</ul>
<h4 id="5-3-1"><span class="section-number">5.3.1</span>问题：form.validate_on_submit() 总是返回 false</h4>
<p>原因：这是 WTForms 的一个经典的坑，需要在表单前加上 form.csrf_token 和
form.hidden_tag() 才能避免这种情况。</p>
<ul><li><a href="http://stackoverflow.com/questions/10722968/flask-wtf-validate-on-submit-is-never-executed"><a href="http://stackoverflow.com/questions/10722968/flask-wtf-validate-on-submit-is-never-executed">http://stackoverflow.com/questions/10722968/flask-wtf-validate-on-submit-is-never-executed</a></a></li>
</ul>
<h4 id="5-3-2"><span class="section-number">5.3.2</span>用 model 来构造 form</h4>
<pre class="prettyprint"><code class="language-python">log_config = LogConfig.query.filter_by(log_module_id=log_module_id).first()
...
form = EditLogConfigForm(obj=log_config)
return render_template(&#39;edit.html&#39;, log_config=log_config, form=form)</code>
</pre>
<h4 id="5-3-3"><span class="section-number">5.3.3</span>用 form 来更新 model</h4>
<p>解法：实现一个用 form 来更新 model 的函数（如下）。</p>
<pre class="prettyprint"><code class="language-python">@staticmethod
def update_model_by_form(form, model):
    for key, value in form.data.items():
        if value != &#39;&#39;:
            model.__setattr__(key, value)</code>
</pre>
<p>完整的代码如下：</p>
<pre class="prettyprint"><code class="language-python"># 编辑日志配置
@main.route(&#39;/edit/&#60;int:log_module_id&#62;&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def edit_log_config(log_module_id):
    log_config = LogConfig.query.filter_by(log_module_id=log_module_id).first()
    if not log_config:
        return &#39;没找到！&#39;
    form = EditLogConfigForm()
    if form.validate_on_submit():
        # 用 form 来更新 model
        Utils.update_model_by_form(form, log_config)
        db.session.add(log_config)
        db.session.commit()
        return &#39;编辑成功&#39;
    else:
        # 用 model 来生成 form
        form = EditLogConfigForm(obj=log_config)
        return render_template(&#39;edit.html&#39;, log_config=log_config, form=form)</code>
</pre>
<h4 id="5-3-4"><span class="section-number">5.3.4</span>遍历 form，访问其各个字段的各个属性</h4>
<pre class="prettyprint"><code class="language-python">    @staticmethod
    def list_all_field_errors_of_form(form):
        for field in form:
            if field.errors:
                form_errors = &#39;\n&#39;
                form_errors += field.label.text + &#39; - &#39;
                form_errors += &#39; &#39;.join(field.errors)
        return form_errors</code>
</pre>
<p>几个要点：</p>
<ol><li>通过 <code>for field in form:</code> 可以直接遍历 form</li>
<li>访问 field label 要通过 field.label.text，而访问 field value 则要用 field.xxx.data<p>（xxx 是字段名）</p>
</li>
</ol>
<h4 id="5-3-5"><span class="section-number">5.3.5</span>Form 中的某些字段（如密码，Token）只对部分用户展示</h4>
<p>我的做法是直接 delete 这个字段，然后页面就不显示了，如下：</p>
<pre class="prettyprint"><code class="language-python">modify_xxx_info_form = ModifyXxxInfoForm(obj=xxxxx_config)
del modify_xxx_info_form.pub_token</code>
</pre>
<h4 id="20150303"><span class="section-number">20150303</span>为 WTForms 的 SelectField 加入动态选择项 &#60;2015-03-03 二&#62;</h4>
<p>一般情况，我们是直接在 SelectField 定义 choices 的，这样有个问题是无法动态
化，例如我们的选项来自于数据库的某张表，而该表是动态变化的。</p>
<p>为了使 SelectField 可以动态化，我之前的解法是先构造 Form，然后在传代码里设
置 choices，然后将 Form 传给 View。</p>
<pre class="prettyprint"><code class="language-python">  cluster_configs = ClusterConfig.query.all()
  cluster_choices = [(&#39;&#39;, &#39;请选择&#39;)]
  for cluster_config in cluster_configs:
      cluster_choices.append((cluster_config.cluster_name, &#39;12&#39; + cluster_config.cluster_name))
  submit_migration_form.dest_cluster_name.choices = cluster_choices</code>
</pre>
<p>这样虽然实现了动态化，但是在表单验证 form.validate__on__submit() 时，WTForms
会因为 choices 为 None 报错，我们可以再表单验证前再次执行上面的手工设置
choices，但是这样极度的不优雅。</p>
<p>一种较好的解法是重写表单的构造函数。方法如下：</p>
<pre class="prettyprint"><code class="language-python">def __init__(self):
    super(SubmitClusterMigrationForm, self).__init__()

    from minos.models import ClusterConfig
    cluster_configs = ClusterConfig.query.all()
    cluster_choices = [(&#39;&#39;, &#39;请选择&#39;)]
    for cluster_config in cluster_configs:
        cluster_choices.append((cluster_config.cluster_name, cluster_config.cluster_name))
    self.dest_cluster_name.choices = cluster_choices</code>
</pre>
<h3 id="5-4"><span class="section-number">5.4</span>WTForms-Components</h3>
<pre>WTForms-Components provides various additional fields, validators and widgets for WTForms.</pre>
<ul><li><a href="http://wtforms-components.readthedocs.org/en/latest/">WTForms-Components Docs</a></li>
<li><a href="http://www.w3school.com.cn/html5/html_5_form_input_types.asp">HTML5 input 类型</a></li>
</ul>
<p>感想：该扩展提供的 DateTimeField 就很赞，让我可以快速地实现 DateTime Picker。美中
不足的是不同浏览器对 HTML5 的一些 input type 的支持参差不齐，例如，Chrome 不支持
DateTimeField，但支持 DateTimeLocalField。</p>
<h3 id="5-5"><span class="section-number">5.5</span>Flash-Script</h3>
<h4 id="5-5-1"><span class="section-number">5.5.1</span>在 shell 下操纵 Flash App</h4>
<p>在 manager.py 中加入：</p>
<pre class="prettyprint"><code class="language-python">from flask.ext.script import Manager, Shell
...
manager.add_command(&#39;shell&#39;, Shell(make_context=make_shell_context))</code>
</pre>
<p>然后，执行 python manager.py shell，即可在 shell 中启动一个 Python 解释器，且运行环境
中包含整个 Flash App，我们可以在这个运行环境中执行 <b>db.create_all()</b> 来建表等操作。</p>
<h4 id="5-5-2"><span class="section-number">5.5.2</span>配置启动的端口号</h4>
<p>通过 -p 传入：</p>
<pre class="prettyprint"><code class="language-sh">python manage.py  runserver -p 8099 </code>
</pre>
<h4 id="5-5-3"><span class="section-number">5.5.3</span>自定义 command</h4>
<h3 id="5-6"><span class="section-number">5.6</span>Flask-Bootstrap</h3>
<ul><li><a href="http://pythonhosted.org/Flask-Bootstrap/basic-usage.html">Flask Bootstrap Docs</a></li>
</ul>
<h3 id="5-7"><span class="section-number">5.7</span>Flask-SQLAlchemy </h3>
<ul><li><a href="https://pythonhosted.org/Flask-SQLAlchemy/index.html">Flask-SQLAlchemy Docs</a></li>
</ul>
<h4 id="5-7-1"><span class="section-number">5.7.1</span>如何只 select 指定 column</h4>
<p>解法：使用 with_entities。例如：</p>
<pre class="prettyprint"><code class="language-python">log_module_ids = LogConfig.query.with_entities(LogConfig.log_module_id).filter_by(cluster_name=cluster_name).all()</code>
</pre>
<h4 id="20151214"><span class="section-number">20151214</span>如何动态指定要 select 的 column  &#60;2015-12-14 一&#62;</h4>
<p>解法：配合使用 <code>with_entities</code> 和 <code>add_columns</code> 。如下：</p>
<pre class="prettyprint"><code class="language-py">    data_slices = DataSlice.query.with_entities(DataSlice.base_time).\
        add_columns(&#39;is_%s_notified&#39; % downstream).\
        filter_by(log_module_id=log_module_id).order_by(DataSlice.base_time).\
        limit(slice_num_limit).all()</code>
</pre>
<p>注意点：</p>
<ul><li>不能只使用 <code>add_columns</code> 而不使用 <code>with_entities</code> ，这样 selelect 出来的<p>columns 是全集</p>
</li>
</ul>
<h4 id="5-7-3"><span class="section-number">5.7.3</span>“MySQL server has gone away” 问题</h4>
<p>原因：MySQL 服务器有 wait_timeout 这样一批超时参数，它会定期回收超时的连接。
如果连接被回收了，而 SQLAlchemy 客户端对应该连接的 session 还在，这是执行 SQL
操作会报上面的异常。</p>
<p>解法：配置 SQLALCHEMY_POOL_RECYCLE，让其值小于 MySQL 服务器端的超时参数。</p>
<ul><li><a href="http://pythonhosted.org/Flask-SQLAlchemy/config.html">Flask-SQLAlchemy Configuration</a></li>
</ul>
<h4 id="20150302"><span class="section-number">20150302</span>SQLAlchemy 中如何拷贝对象（object copy）？&#60;2015-03-02 一&#62;</h4>
<p>SQLAlchemy 的 object 无法使用 python 的 copy.copy 或者 copy.deepcopy 来执行
对象拷贝，因为 object 有一些字段是特殊的（如_sa_state 等），如果这样拷贝的
好，得到的 object 是无法执行插入到数据库的。我的一个解法是在为 Model 定义一
个 duplicate() 方法，在里面拷贝表字段，而不拷贝特殊字段。</p>
<pre class="prettyprint"><code class="language-python">class LogConfig(db.Model):
    __tablename__ = &#39;log_config&#39;
    ...
    ...
    def __repr__(self):
       return str({c.name: getattr(self, c.name) for c in self.__table__.columns})

    def duplicate(self):
        arguments = dict()
        for name, column in self.__mapper__.columns.items():
            if not (column.primary_key or column.unique):
                arguments[name] = getattr(self, name)
        return self.__class__(**arguments)</code>
</pre>
<h4 id="20150925"><span class="section-number">20150925</span>Flask-SQLAlchemy 如何开启 auto commit？ &#60;2015-09-25 五&#62;</h4>
<p>DBA 建议我们将 autocommit 开启，否则 MySQL 容易发生很蛋疼的事务时间过长的问
题。我开启了，但是这样改带来的副作用就是，每次 insert/update 都对应一次
commit，写入效率降低（当然，可以通过手动开启事务来实现单次 commit）</p>
<pre class="prettyprint"><code class="language-py">db = SQLAlchemy(session_options={&#39;autocommit&#39;: True})</code>
</pre>
<p>此时，事务相当于关闭。如果我们想提高批量执行 insert/update 的效率，我们可以
这样：</p>
<pre class="prettyprint"><code class="language-py">db.session.begin()
# do something
db.session.commit()</code>
</pre>
<h4 id="20151121"><span class="section-number">20151121</span>解决 auto commit 开启后，退出 Flask 时抛出 No transaction is begun 异常的问题 &#60;2015-11-21 六&#62;</h4>
<p>具体异常如下：</p>
<pre class="prettyprint"><code class="language-py">  ...
  File &#34;/Library/Python/2.7/site-packages/flask/app.py&#34;, line 1727, in do_teardown_appcontext
    func(exc)
  File &#34;/Library/Python/2.7/site-packages/flask_sqlalchemy/__init__.py&#34;, line 751, in shutdown_session
    self.session.commit()
  File &#34;/Library/Python/2.7/site-packages/sqlalchemy/orm/scoping.py&#34;, line 149, in do
    return getattr(self.registry(), name)(*args, **kwargs)
  File &#34;/Library/Python/2.7/site-packages/sqlalchemy/orm/session.py&#34;, line 763, in commit
    raise sa_exc.InvalidRequestError(&#34;No transaction is begun.&#34;)
sqlalchemy.exc.InvalidRequestError: No transaction is begun.</code>
</pre>
<p>原因：SQLALCHEMY_COMMIT_ON_TEARDOWN 和 auto_commit 相冲突</p>
<p>（貌似有问题）
<code>解法：当开启了 auto_commit 后，关掉 SQLALCHEMY_COMMIT_ON_TEARDOWN</code></p>
<h2 id="6"><span class="section-number">6</span>URL 路由和请求处理</h2>
<h3 id="6-1"><span class="section-number">6.1</span>如何处理 GET 方式的 search?query=xxx 形式的 URL？</h3>
<pre class="prettyprint"><code class="language-python">@main.route(&#39;/search&#39;)
def search():
    query = request.args.get(&#39;query&#39;)
...</code>
</pre>
<p></p>
<h3 id="6-2"><span class="section-number">6.2</span>如何处理 POST 方式的参数在 post data 里的情况？</h3>
<p>答案：在 request.form 里取，而不是 request.args 里面取！</p>
<h3 id="6-3"><span class="section-number">6.3</span>URL 中带有 &#39;/&#39; 时该如何路由？</h3>
<p>Flask 不仅支持 int/float/string 类型的 URL 字段的路由，还支持一种 path 字段，该种字段
里可以包含 &#39;/&#39;。不过要注意的是，path 字段不能以 &#39;/ 作为开头！ 这是一个不方便的地
方。</p>
<pre class="prettyprint"><code class="language-python">@main.route(&#39;/ls/&#60;int:log_module_id&#62;/&#60;hostname&#62;/&#60;path:directory&#62;&#39;)
def list_dir(log_module_id, hostname, directory):
    ftp_dir = &#34;ftp://&#34; + hostname + &#39;/&#39; + directory</code>
</pre>
<ul><li><a href="http://flask.pocoo.org/snippets/76/">Handling URLs containing slash &#39;/&#39; character</a></li>
</ul>
<h3 id="6-4"><span class="section-number">6.4</span>如何向后端 POST 参数格式为 JSON 的请求？</h3>
<pre class="prettyprint"><code class="language-javascript">var data = {log_plan_id: log_plan_id, machines: machines}
$.ajax({
    type : &#34;POST&#34;,
    url : &#34;/batch_restart_agents&#34;,
    data: JSON.stringify(data, null, &#39;\t&#39;),
    contentType: &#39;application/json;charset=UTF-8&#39;,
    success: function(result) {
        alert(result);
    },
    error: function() {
        alert(&#39;服务器端发生异常或者返回数据格式不正确!&#39;);
        return false;
    }
});</code>
</pre>
<p>后端需要在 request.json 里面获取参数。</p>
<h3 id="6-5"><span class="section-number">6.5</span>Flask 处理 404 和 500 错误码</h3>
<p>示例代码如下：</p>
<pre class="prettyprint"><code class="language-py">@main.app_errorhandler(404)
def page_not_found(e):
    return render_template(&#39;404.html&#39;), 404

@main.app_errorhandler(500)
def internal_server_error(e):
    return render_template(&#39;500.html&#39;), 500</code>
</pre>
<p>注意：使用 <code>app_errorhandler</code> ，不用 <code>errorhandler</code> ，后者会遇到下面的错误。</p>
<pre class="prettyprint"><code class="language-sh">AssertionError: It is currently not possible to register a 500 internal server error on a per-blueprint level.</code>
</pre>
<p>参考：</p>
<ul><li><a href="http://stackoverflow.com/questions/30108000/flask-register-blueprint-error-python">http://stackoverflow.com/questions/30108000/flask-register-blueprint-error-python</a></li>
</ul>
<h2 id="7"><span class="section-number">7</span>Cookies and Sessions</h2>
<p>Cookies 和 Sessions 的一个重要区别在于：浏览器关闭时，Sessions 会清空，而 Cookies 不
会，只有过期后才会清除。</p>
<h3 id="7-1"><span class="section-number">7.1</span>每次请求前通过 Cookies 获取用户名</h3>
<p>下面代码是个例子，@main.before_app_request 下面定义了一个钩子函数，main 这个 app 每
次处理请求前，都会执行这个函数，尝试从 Cookies 中获取 minos_user，并设置到我自定义的
request.minos_user 变量中。如果没在 Cookies 中，则会从其他的地方获取（如通过 SSO），
并设置到 Cookies 中，并执行重定向。</p>
<pre class="prettyprint"><code class="language-python">@main.before_app_request
def before_request():
    request.minos_user = request.cookies.get(&#39;minos_user&#39;)
    if not request.minos_user:
        print &#39;not found&#39;
        if request.host.startswith(&#39;localhost&#39;):
            request.minos_user = &#39;zhongyi_test&#39;
        else:
            # Get and set minos_user

        response = make_response(redirect(request.url))
        response.set_cookie(&#39;minos_user&#39;, request.minos_user, 3600 * 24 * 30)
        return response
    else:
        print &#39;found&#39;</code>
</pre>
<h2 id="8"><span class="section-number">8</span>Http Client</h2>
<p>Flask 不自带 Http Client，需要额外购置。我们可以用 urlib2，不过我对 Tornado 的 Http
Client 更熟悉一点，所以就用它吧。</p>
<ul><li><a href="http://runnable.com/Us3h5Ccn6TFMAAGu/python-tornado-http-client-example">Python Tornado HTTP client example (Runable)</a> </li>
</ul>
<h3 id="8-1"><span class="section-number">8.1</span>使用 Requests</h3>
<p>发现了一个更易用的库：</p>
<ul><li><a href="http://docs.python-requests.org/en/latest/">Requests: HTTP for Humans</a></li>
</ul>
<h2 id="9"><span class="section-number">9</span>异步，多线程，后台任务相关</h2>
<h3 id="9-1"><span class="section-number">9.1</span>使用 Celery</h3>
<p>我需要在 Flask 中定期运行一类繁重的任务（主要是每日的业务统计），该任务需要额外的执
行线程，还需要拥有 Flask 的执行环境（如数据库配置等），看起来 Celery 能解决我的问题。</p>
<ul><li><a href="http://www.celeryproject.org/"><a href="http://www.celeryproject.org/">http://www.celeryproject.org/</a></a></li>
<li><a href="https://github.com/celery/celery"><a href="https://github.com/celery/celery">https://github.com/celery/celery</a></a></li>
<li><a href="http://flask.pocoo.org/docs/0.10/patterns/celery/">Celery Based Background Tasks</a></li>
<li><a href="https://github.com/thrisp/flask-celery-example"><a href="https://github.com/thrisp/flask-celery-example">https://github.com/thrisp/flask-celery-example</a></a> （该 example 已经过期！）</li>
</ul>
<h2 id="10"><span class="section-number">10</span>Jinja 相关</h2>
<h3 id="10-1"><span class="section-number">10.1</span>使用 macro 来快速实现带表单的 Modal（模态窗口）</h3>
<pre class="prettyprint"><code class="language-html">{% macro render_modal_from_form(modal_id, modal_title, form) %}
    &#60;div class=&#34;modal fade&#34; id=&#34;{{ modal_id }}&#34; tabindex=&#34;-1&#34; role=&#34;dialog&#34; aria-labelledby=&#34;&#34; aria-hidden=&#34;true&#34;&#62;
        &#60;div class=&#34;modal-dialog&#34;&#62;
            &#60;div class=&#34;modal-content&#34;&#62;
                &#60;div class=&#34;modal-header&#34;&#62;
                    &#60;button type=&#34;button&#34; class=&#34;close&#34; data-dismiss=&#34;modal&#34;&#62;&#60;span aria-hidden=&#34;true&#34;&#62;&#38;times;&#60;/span&#62;&#60;span class=&#34;sr-only&#34;&#62;Close&#60;/span&#62;&#60;/button&#62;
                    &#60;h4 class=&#34;modal-title&#34;&#62;{{ modal_title }}&#60;/h4&#62;
                &#60;/div&#62;
                &#60;div class=&#34;modal-body&#34;&#62;
                    {{ bs_wtf.quick_form(form, form_type=&#39;basic&#39;, button_map={&#39;submit&#39;:&#39;primary&#39;}) }}
                &#60;/div&#62;
            &#60;/div&#62;
        &#60;/div&#62;
    &#60;/div&#62;
{% endmacro %}</code>
</pre>
<p>要点：</p>
<ol><li>使用 Flask-Bootstrap 的 quick_form() 来一键生成表单</li>
<li>使用 Flask 的</li>
</ol>
<h3 id="10-2"><span class="section-number">10.2</span>在 Jinja 模板文件中调用 Python 函数</h3>
<p>Jinja 的 Environment 的 globals 变量（是个字典）可以注册 Python 函数，如果
在 Flask 框架下，可以这样实现：</p>
<pre class="prettyprint"><code class="language-python">    minos = Flask(__name__, template_folder=template_folder)
    ...
    from minos.utils import Utils
    minos.jinja_env.globals.update(check_if_user_is_admin=Utils.check_if_user_is_admin)</code>
</pre>
<p>这样，我们就可以在模板文件的任何地方调用该函数了（其实就是一个判断访问用户
是否为管理员的函数）。</p>
<pre class="prettyprint"><code class="language-html">&#60;div&#62;
    {% if check_if_user_is_admin(request.minos_user) %}
        {{ macros.render_number_field(name=&#39;retention_days_num&#39;, label=&#39;集群保存天数&#39;,
            value=log_config_in_master.retention_days_num,
            min=&#39;1&#39;) }}
    {% endif %}
&#60;/div&#62;</code>
</pre>
<p>如果是原生 Jinja 的话，网上有个可以参考的代码段：</p>
<pre class="prettyprint"><code class="language-python">from jinja2 import Environment, FileSystemLoader

def clever_function(a, b):
    return u&#39;&#39;.join([b, a])

env = Environment(loader=FileSystemLoader(&#39;/path/to/templates&#39;))
env.globals[&#39;clever_function&#39;] = clever_function</code>
</pre>
<ul><li><a href="http://stackoverflow.com/questions/6036082/call-a-python-function-from-jinja2">Call a python function from jinja2</a></li>
</ul>
<h3 id="20151209"><span class="section-number">20151209</span>Filters in Jinja2 &#60;2015-12-09 三&#62;</h3>
<p>Jinja2 内建了非常丰富的 filter，所以说，当我们遇到相关需求时，应该先在
Jinja2 提供的 filter 里面找。</p>
<ul><li><a href="http://jinja.pocoo.org/docs/dev/templates/#builtin-filters"><a href="http://jinja.pocoo.org/docs/dev/templates/#builtin-filters">http://jinja.pocoo.org/docs/dev/templates/#builtin-filters</a></a><p></p>
</li>
</ul>
<h4 id="10-3-1"><span class="section-number">10.3.1</span>truncate: 字符串截断显示</h4>
<p>例如，我们为了有一个字符串过长在页面上不雅观想将长度大于 50 的部分截断并填
充以省略号这样的需求。我们在 Jinja2 内建的 filter 里找，结果发现了
<code>truncate</code> 这个 filter，它完美地满足了我们的需求：</p>
<dl><dt>truncate(s, length=255, killwords=False, end=&#39;...&#39;)</dt>
<dd>Return a truncated<p>copy of the string. The length is specified with the first parameter
which defaults to 255. If the second parameter is true the filter will
cut the text at length. Otherwise it will discard the last word. If
the text was in fact truncated it will append an ellipsis sign
(&#34;...&#34;). If you want a different ellipsis sign than &#34;...&#34; you can
specify it using the third parameter.</p>
</dd>
</dl>
<pre class="prettyprint"><code class="language-py">{{ &#34;foo bar baz&#34;|truncate(9) }}
    -> &#34;foo ...&#34;
{{ &#34;foo bar baz&#34;|truncate(9, True) }}
    -> &#34;foo ba...&#34;</code>
</pre>
<h2 id="11"><span class="section-number">11</span>Cache</h2>
<ul><li><a href="http://flask.pocoo.org/docs/0.10/patterns/caching/">Flask Caching</a></li>
<li><a href="https://pythonhosted.org/Flask-Cache/">Flask-Cache</a>  </li>
</ul>
<h3 id="11-1"><span class="section-number">11.1</span>一个简单的 Cache 实现</h3>
<pre class="prettyprint"><code class="language-python">def get_my_item():
    rv = cache.get(&#39;my-item&#39;)
    if rv is None:
        rv = calculate_value()
        cache.set(&#39;my-item&#39;, rv, timeout=5 * 60)
    return rv</code>
</pre>
<h3 id="11-2"><span class="section-number">11.2</span>利用 Flask-Cache 来 Cache 某个 View Function</h3>
<pre class="prettyprint"><code class="language-python">@cache.cached(timeout=50)
def index():
    return render_template(&#39;index.html&#39;)</code>
</pre>
<p>由于在 Flask 中，View Function 是不重名的，所以在 为其做 Cache 时，很容易找到一个唯
一的 Key。</p>
<h2 id="12"><span class="section-number">12</span>数据库相关</h2>
<h3 id="12-1"><span class="section-number">12.1</span>忠告</h3>
<p><b>数据库相关操作需要谨慎</b> ！！！例如做数据库迁移时，要仔细阅读迁移工具生成的脚本，了
解其带来的影响和后果， <b>尤其要看是否有 drop table/drop column 的操作</b> ，确认影响后再执
行迁移。如下图的迁移脚本的 upgrade 会删掉两张表，这可能不是我们期望的：</p>
<pre class="prettyprint"><code class="language-python">def upgrade():
    ### commands auto generated by Alembic - please adjust! ###
    op.drop_table(&#39;notice_dtmeta&#39;)
    op.drop_table(&#39;minos_data_back&#39;)
    op.drop_table(&#39;data_slice&#39;)
    op.add_column(&#39;log_config&#39;, sa.Column(&#39;associated_log_module_ids&#39;, sa.String(length=2048), nullable=True))
    op.add_column(&#39;log_config&#39;, sa.Column(&#39;is_open_associated_notify&#39;, sa.Boolean(), nullable=True))
    op.add_column(&#39;log_config&#39;, sa.Column(&#39;notify_delay_minutes&#39;, sa.Integer(), nullable=True))
    ### end Alembic commands ###</code>
</pre>
<p>对于一个数据库，如果既有 ORM 在用，也有手工 DDL (Data Definition Language, such as
CREATE, DROP, ALTER)，则迁移脚本可能会将手工建立的表给完全地抹去。 <b>所以说，我们
应该只在一个地方执行数据库的 DDL</b> ，如果用了 ORM，则就用 ORM 提供的迁移设施来执行 DDL。</p>
<pre>数据库一般都有回滚到某个版本的功能，不知道此功能是否能完美恢复被 drop 的 table？</pre>
<h3 id="12-2"><span class="section-number">12.2</span>如何做数据库迁移</h3>
<p>就几步：</p>
<ol><li>使用 Flask-Migrate</li>
<li>py manage.py db init</li>
<li>py manage.py db migrate -m &#34;add fields: associated notify and notify delay minutes&#34;</li>
<li>py manage.py db upgrade  </li>
</ol>
<p>最终显示：</p>
<pre class="prettyprint"><code class="language-sh">$ xxxx git:(master) ✗ py manage.py db upgrade                                                            
INFO  [alembic.migration] Context impl MySQLImpl.
INFO  [alembic.migration] Will assume non-transactional DDL.
INFO  [alembic.migration] Running upgrade None -> 389afadb5dd3, add fields: associated notify and notify delay minutes</code>
</pre>
<h4 id="12-2-1"><span class="section-number">12.2.1</span>感受</h4>
<p>以前我是先改 modes.py，然后登录数据库执行 alter table xxx add column 加字段，现在用
上了专业的数据库迁移工具，感觉确实很好。以后我不会再手工加字段了。</p>
<h3 id="12-3"><span class="section-number">12.3</span>如何在 Flask App 外部使用 Flask-SQLAlchemy？</h3>
<p>Flask-SQLAlcyemy 依赖 Flask App Context，如果没有这个 Context，那么使用时会抛
出 &#34;application not registered on db instance and no application bound to
current context&#34; 这样的异常。要想解决这个问题，只能在外部构造一个 Flask App
Context。如下：</p>
<pre class="prettyprint"><code class="language-python">app = create_app(&#39;default&#39;)
with flask_app.app_context():
    ftp_configs = FtpConfig.query.all()</code>
</pre>
<p>参考：
<a href="http://stackoverflow.com/questions/24060553/creating-a-database-outside-the-application-context">http://stackoverflow.com/questions/24060553/creating-a-database-outside-the-application-context</a></p>
<h4 id="12-3-1"><span class="section-number">12.3.1</span>感想</h4>
<p>看来 Flask 主要定位于简单的 CRUD 级别的 Web 开发，想利用它启动一些例如定期任务之类的
功能看样子还挺不方便的。</p>
<h3 id="20150309"><span class="section-number">20150309</span>在 Flask 下使用 SQLite  &#60;2015-03-09 一&#62;</h3>
<p>SQLite 的并发性能很低，因为它是通过文件锁来实现并发的，是库级别的锁。这个决
定它的适用范围。如：</p>
<ul><li>不适合多线程访问</li>
<li>不适合高耗时 SQL</li>
<li>在 SQLAlchemy 下使用，会发生意想不到的异常</li>
</ul>
<p>SQLite 被锁住时，SQLAlchemy 抛出的异常：</p>
<pre class="prettyprint"><code class="language-sh">sqlalchemy.exc.OperationalError: (OperationalError) database is locked u&#39;UPDATE ftp_task SET task_status=? WHERE ftp_task.id = ?&#39; (&#39;done&#39;, 2576)</code>
</pre>
<h3 id="12-5"><span class="section-number">12.5</span>Multiple Databases</h3>
<ul><li><a href="https://pythonhosted.org/Flask-SQLAlchemy/binds.html">Multiple Databases with Binds</a></li>
</ul>
<h2 id="13"><span class="section-number">13</span>Flask 部署</h2>
<p>我使用下面手法，来简化我的 Flask 应用的部署：</p>
<ol><li>使用 virtualenv，将所有依赖库放在子目录里，并 push 到 git 仓库里</li>
<li>使用 Tornado 作为 Web 服务器和 WSGI 容器</li>
<li>使用 Supervisor 来启停</li>
<li>在前端再加一层 Nginx 反向代理</li>
</ol>
<p>于是，我的部署过程就变成了这样：</p>
<ol><li>找一台服务器，创建目录</li>
<li>git clone 我的 Flask 应用的代码仓库</li>
<li>进入 virualevn 环境（重要！必须先于 supervisord 的启动）</li>
<li>配置 supervisord.conf</li>
<li>启动 supervisord<p></p>
</li>
</ol>
<p>supervisord.conf 的配置方法是加入下面几行：</p>
<pre class="prettyprint"><code class="language-sh">...
[inet_http_server]         ; inet (TCP) server disabled by default                                  
port=*:8400                 ; (ip_address:port specifier, *:port for all iface)                     
username=minos              ; (default is no username (open server))                                
password=xxxxx               ; (default is no password (open server))             
...
[program:minos-web-1]                                                                                  
command=python runtornado.py                                    ; the program (relative uses PATH, can take args)
process_name=%(program_name)s                                   ; process_name expr (default %(program_name)s)
directory=/home/work/minos/web                                  ; directory to cwd to before exec (def no cwd)
stdout_logfile=/home/work/minos/web/log/supervisor.log          ; stdout log path, NONE for none; default AUTO
stderr_logfile=/home/work/minos/web/log/supervisor.wf.log       ; stderr log path, NONE for none; default AUTO
stopsignal=KILL                                                 ; signal used to kill process (default TERM)
...</code>
</pre>
<p>通过这样的配置，我还可以在 Web 上直接启停我的 Flask 应用，HTTP 端口就像我配置的
那样，是 8400。</p>
<h2 id="14"><span class="section-number">14</span>Miscellaneous</h2>
<h3 id="14-1"><span class="section-number">14.1</span>处理 Ajax</h3>
<p>Flask 提供了快捷的 jsonify 函数，能将 dict 或其他值转化为 JSON 格式，并
通过 return 直接返回给浏览器。</p>
<ul><li><a href="http://dormousehole.readthedocs.org/en/latest/patterns/jquery.html">通过 jQuery 使用 AJAX</a></li>
</ul>
<h3 id="14-2"><span class="section-number">14.2</span>邮件</h3>
<ul><li><a href="http://flask.pocoo.org/docs/0.10/errorhandling/">Logging Application Errors</a></li>
</ul>
<p>Python 的 logging 库支持将邮件发送，并可以指定日志等级大于多少的才发。不
过需要搞 SMTP，而公司项目一般用 sendmail 指令，所以我包装一下 sendmail，
将一些重要的错误发到我的邮箱里。</p>
<pre class="prettyprint"><code class="language-python">    @staticmethod
    def send_mail(body):
        p = os.popen(&#34;/usr/sbin/sendmail -t&#34;, &#34;w&#34;)
        p.write(&#34;MIME-Version: 1.0\n&#34;)
        p.write(&#34;Content-type:text/html;charset=utf-8\n&#34;)
        p.write(&#34;From: %s\n&#34; % &#34;xxx-admin@xxx.com&#34;)
        p.write(&#34;To: %s\n&#34; % &#34;zy@xxx.com&#34;)
        p.write(&#34;Subject: A Mail from Xxx (xxx.xxx.com)\n&#34;)
        p.write(&#34;\n&#34;)
        p.write(body)
        p.close()</code>
</pre>
<p></p>
<h3 id="14-3"><span class="section-number">14.3</span>在 Flask 里使用 Redis</h3>
<ul><li><a href="http://flask.pocoo.org/snippets/71/">Counting Online Users with Redis</a></li>
<li><a href="http://flask.pocoo.org/snippets/75/">Server-side Sessions with Redis</a></li>
</ul>
<h3 id="14-4"><span class="section-number">14.4</span>Angular.js with Flask</h3>
<p>如果哪天我要使用 Angular.js 的话，就再详细读一下下面的文章吧。</p>
<ul><li><a href="http://stackoverflow.com/questions/11522151/typical-angular-js-workflow-and-project-structure-with-python-flask/">Typical Angular.js workflow and project structure (with Python Flask)</a></li>
</ul>
<h2 id="15"><span class="section-number">15</span>RESTful API</h2>
<p>Django下面有强大易用的Django RESTful Framework，Flask下有一个叫
Flask-Restless的，短小精悍，但基本能够替代DRF。</p>
<h2 id="16"><span class="section-number">16</span>回顾</h2>
<h3 id="20140920"><span class="section-number">20140920</span>Flask 是个比 Tornado 更加理想的 Web 框架 &#60;2014-09-20 六&#62;</h3>
<p>今天在西安校招结束了，坐高铁回北京，路上无聊开始学习 Flask，发现了很多让我
想立马就用的特性。不过回公司后还有很多事情要处理，等国庆节时，我再抽出个三
天来把 Minos 平台用 Flask 给重构一把。</p>
</div></div><div class="col-md-3" data-reactid="41"><div id="toc" data-reactid="42"><ul class="nav nav-toc"><li><a href="#1"><span class="section-number">1</span>Introduction</a></li>
<li><a href="#2"><span class="section-number">2</span>资料搜集</a><ul class="nav nav-toc"><li><a href="#2-1"><span class="section-number">2.1</span>Flask Blog</a></li>
<li><a href="#2-2"><span class="section-number">2.2</span>Flask BB</a></li>
<li><a href="#2-3"><span class="section-number">2.3</span>谁在使用 Flask？</a></li>
</ul>
</li>
<li><a href="#3"><span class="section-number">3</span>学习 Flask 文档</a><ul class="nav nav-toc"><li><a href="#3-1"><span class="section-number">3.1</span>官方文档</a></li>
<li><a href="#3-2"><span class="section-number">3.2</span>The Flask Mega-Tutorial</a></li>
<li><a href="#3-3"><span class="section-number">3.3</span>Flask Web Development</a></li>
</ul>
</li>
<li><a href="#4"><span class="section-number">4</span>阅读 Flask 源码</a><ul class="nav nav-toc"><li><a href="#4-1"><span class="section-number">4.1</span>源码总览和阅读意义</a></li>
<li><a href="#4-2"><span class="section-number">4.2</span>app.py</a></li>
</ul>
</li>
<li><a href="#5"><span class="section-number">5</span>Flask 扩展</a><ul class="nav nav-toc"><li><a href="#20151206"><span class="section-number">20151206</span>我的 Python Flask 依赖库列表 &#60;2015-12-06 日&#62;</a></li>
<li><a href="#5-2"><span class="section-number">5.2</span>Flask-Admin</a></li>
<li><a href="#5-3"><span class="section-number">5.3</span>WTForms</a></li>
<li><a href="#5-4"><span class="section-number">5.4</span>WTForms-Components</a></li>
<li><a href="#5-5"><span class="section-number">5.5</span>Flash-Script</a></li>
<li><a href="#5-6"><span class="section-number">5.6</span>Flask-Bootstrap</a></li>
<li><a href="#5-7"><span class="section-number">5.7</span>Flask-SQLAlchemy </a></li>
</ul>
</li>
<li><a href="#6"><span class="section-number">6</span>URL 路由和请求处理</a><ul class="nav nav-toc"><li><a href="#6-1"><span class="section-number">6.1</span>如何处理 GET 方式的 search?query=xxx 形式的 URL？</a></li>
<li><a href="#6-2"><span class="section-number">6.2</span>如何处理 POST 方式的参数在 post data 里的情况？</a></li>
<li><a href="#6-3"><span class="section-number">6.3</span>URL 中带有 &#39;/&#39; 时该如何路由？</a></li>
<li><a href="#6-4"><span class="section-number">6.4</span>如何向后端 POST 参数格式为 JSON 的请求？</a></li>
<li><a href="#6-5"><span class="section-number">6.5</span>Flask 处理 404 和 500 错误码</a></li>
</ul>
</li>
<li><a href="#7"><span class="section-number">7</span>Cookies and Sessions</a><ul class="nav nav-toc"><li><a href="#7-1"><span class="section-number">7.1</span>每次请求前通过 Cookies 获取用户名</a></li>
</ul>
</li>
<li><a href="#8"><span class="section-number">8</span>Http Client</a><ul class="nav nav-toc"><li><a href="#8-1"><span class="section-number">8.1</span>使用 Requests</a></li>
</ul>
</li>
<li><a href="#9"><span class="section-number">9</span>异步，多线程，后台任务相关</a><ul class="nav nav-toc"><li><a href="#9-1"><span class="section-number">9.1</span>使用 Celery</a></li>
</ul>
</li>
<li><a href="#10"><span class="section-number">10</span>Jinja 相关</a><ul class="nav nav-toc"><li><a href="#10-1"><span class="section-number">10.1</span>使用 macro 来快速实现带表单的 Modal（模态窗口）</a></li>
<li><a href="#10-2"><span class="section-number">10.2</span>在 Jinja 模板文件中调用 Python 函数</a></li>
<li><a href="#20151209"><span class="section-number">20151209</span>Filters in Jinja2 &#60;2015-12-09 三&#62;</a></li>
</ul>
</li>
<li><a href="#11"><span class="section-number">11</span>Cache</a><ul class="nav nav-toc"><li><a href="#11-1"><span class="section-number">11.1</span>一个简单的 Cache 实现</a></li>
<li><a href="#11-2"><span class="section-number">11.2</span>利用 Flask-Cache 来 Cache 某个 View Function</a></li>
</ul>
</li>
<li><a href="#12"><span class="section-number">12</span>数据库相关</a><ul class="nav nav-toc"><li><a href="#12-1"><span class="section-number">12.1</span>忠告</a></li>
<li><a href="#12-2"><span class="section-number">12.2</span>如何做数据库迁移</a></li>
<li><a href="#12-3"><span class="section-number">12.3</span>如何在 Flask App 外部使用 Flask-SQLAlchemy？</a></li>
<li><a href="#20150309"><span class="section-number">20150309</span>在 Flask 下使用 SQLite  &#60;2015-03-09 一&#62;</a></li>
<li><a href="#12-5"><span class="section-number">12.5</span>Multiple Databases</a></li>
</ul>
</li>
<li><a href="#13"><span class="section-number">13</span>Flask 部署</a></li>
<li><a href="#14"><span class="section-number">14</span>Miscellaneous</a><ul class="nav nav-toc"><li><a href="#14-1"><span class="section-number">14.1</span>处理 Ajax</a></li>
<li><a href="#14-2"><span class="section-number">14.2</span>邮件</a></li>
<li><a href="#14-3"><span class="section-number">14.3</span>在 Flask 里使用 Redis</a></li>
<li><a href="#14-4"><span class="section-number">14.4</span>Angular.js with Flask</a></li>
</ul>
</li>
<li><a href="#15"><span class="section-number">15</span>RESTful API</a></li>
<li><a href="#16"><span class="section-number">16</span>回顾</a><ul class="nav nav-toc"><li><a href="#20140920"><span class="section-number">20140920</span>Flask 是个比 Tornado 更加理想的 Web 框架 &#60;2014-09-20 六&#62;</a></li>
</ul>
</li>
</ul>
</div></div></div></div></div><footer class="footer" id="footer" role="contentinfo" data-reactid="43"><div class="container" data-reactid="44"><p data-reactid="45"><!-- react-text: 46 -->本网站由 <!-- /react-text --><a href="http://elvestar.com/about/" target="blank" data-reactid="47">仲毅</a><!-- react-text: 48 --> 创建和维护，使用 <!-- /react-text --><a href="https://www.gnu.org/software/emacs/" target="blank" data-reactid="49">Emacs</a><!-- react-text: 50 --> <!-- /react-text --><a href="http://orgmode.org/" target="blank" data-reactid="51">Org mode</a><!-- react-text: 52 --> 和 <!-- /react-text --><a href="http://nanoc.ws/" target="blank" data-reactid="53">Nanoc</a><!-- react-text: 54 --> 编辑和构建<!-- /react-text --></p><p data-reactid="55"><!-- react-text: 56 -->Licensed under <!-- /react-text --><a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" target="blank" data-reactid="57">CC BY-NC-ND 4.0</a></p><ul class="footer-links" data-reactid="58"><li data-reactid="59">仲之地</li><li data-reactid="60"> · </li><li data-reactid="61"><a href="http://elvestar.com/blog/" target="blank" data-reactid="62">Blog</a></li><li data-reactid="63"> · </li><li data-reactid="64"><a href="http://elvestar.com/notes/" target="blank" data-reactid="65">知识管理</a></li><li data-reactid="66"> · </li><li data-reactid="67"><a href="http://elvestar.com/timeline/" target="blank" data-reactid="68">时间线</a></li><li data-reactid="69"> · </li><li data-reactid="70"><a href="http://elvestar.com/guestbook/" target="blank" data-reactid="71">留言本</a></li></ul></div></footer><div style="display:none;" id="react-mount-inner" data-reactid="72"></div></div></div><script src="/bundle.js?t=1507564180023"></script></body></html>